{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nimport * as nls from '../../../../nls.js';\nimport * as strings from '../../../common/strings.js';\nimport { SubmenuAction, Separator, EmptySubmenuAction } from '../../../common/actions.js';\nimport { ActionBar } from '../actionbar/actionbar.js';\nimport { EventType, EventHelper, removeTabIndexAndUpdateFocus, isAncestor, addDisposableListener, append, $, clearNode, createStyleSheet, isInShadowDOM, getActiveElement, Dimension } from '../../dom.js';\nimport { StandardKeyboardEvent } from '../../keyboardEvent.js';\nimport { RunOnceScheduler } from '../../../common/async.js';\nimport { DisposableStore } from '../../../common/lifecycle.js';\nimport { DomScrollableElement } from '../scrollbar/scrollableElement.js';\nimport { layout } from '../contextview/contextview.js';\nimport { isLinux, isMacintosh } from '../../../common/platform.js';\nimport { Codicon, registerCodicon } from '../../../common/codicons.js';\nimport { BaseActionViewItem, ActionViewItem } from '../actionbar/actionViewItems.js';\nimport { formatRule } from '../codicons/codiconStyles.js';\nimport { isFirefox } from '../../browser.js';\nimport { StandardMouseEvent } from '../../mouseEvent.js';\nimport { stripIcons } from '../../../common/iconLabels.js';\nexport const MENU_MNEMONIC_REGEX = /\\(&([^\\s&])\\)|(^|[^&])&([^\\s&])/;\nexport const MENU_ESCAPED_MNEMONIC_REGEX = /(&amp;)?(&amp;)([^\\s&])/g;\nconst menuSelectionIcon = registerCodicon('menu-selection', Codicon.check);\nconst menuSubmenuIcon = registerCodicon('menu-submenu', Codicon.chevronRight);\nexport var Direction;\n(function (Direction) {\n  Direction[Direction[\"Right\"] = 0] = \"Right\";\n  Direction[Direction[\"Left\"] = 1] = \"Left\";\n})(Direction || (Direction = {}));\nexport class Menu extends ActionBar {\n  constructor(container, actions) {\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    container.classList.add('monaco-menu-container');\n    container.setAttribute('role', 'presentation');\n    const menuElement = document.createElement('div');\n    menuElement.classList.add('monaco-menu');\n    menuElement.setAttribute('role', 'presentation');\n    super(menuElement, {\n      orientation: 2 /* VERTICAL */,\n      actionViewItemProvider: action => this.doGetActionViewItem(action, options, parentData),\n      context: options.context,\n      actionRunner: options.actionRunner,\n      ariaLabel: options.ariaLabel,\n      triggerKeys: {\n        keys: [3 /* Enter */, ...(isMacintosh || isLinux ? [10 /* Space */] : [])],\n        keyDown: true\n      }\n    });\n    this.menuElement = menuElement;\n    this.actionsList.setAttribute('role', 'menu');\n    this.actionsList.tabIndex = 0;\n    this.menuDisposables = this._register(new DisposableStore());\n    this.initializeStyleSheet(container);\n    addDisposableListener(menuElement, EventType.KEY_DOWN, e => {\n      const event = new StandardKeyboardEvent(e);\n      // Stop tab navigation of menus\n      if (event.equals(2 /* Tab */)) {\n        e.preventDefault();\n      }\n    });\n    if (options.enableMnemonics) {\n      this.menuDisposables.add(addDisposableListener(menuElement, EventType.KEY_DOWN, e => {\n        const key = e.key.toLocaleLowerCase();\n        if (this.mnemonics.has(key)) {\n          EventHelper.stop(e, true);\n          const actions = this.mnemonics.get(key);\n          if (actions.length === 1) {\n            if (actions[0] instanceof SubmenuMenuActionViewItem && actions[0].container) {\n              this.focusItemByElement(actions[0].container);\n            }\n            actions[0].onClick(e);\n          }\n          if (actions.length > 1) {\n            const action = actions.shift();\n            if (action && action.container) {\n              this.focusItemByElement(action.container);\n              actions.push(action);\n            }\n            this.mnemonics.set(key, actions);\n          }\n        }\n      }));\n    }\n    if (isLinux) {\n      this._register(addDisposableListener(menuElement, EventType.KEY_DOWN, e => {\n        const event = new StandardKeyboardEvent(e);\n        if (event.equals(14 /* Home */) || event.equals(11 /* PageUp */)) {\n          this.focusedItem = this.viewItems.length - 1;\n          this.focusNext();\n          EventHelper.stop(e, true);\n        } else if (event.equals(13 /* End */) || event.equals(12 /* PageDown */)) {\n          this.focusedItem = 0;\n          this.focusPrevious();\n          EventHelper.stop(e, true);\n        }\n      }));\n    }\n    this._register(addDisposableListener(this.domNode, EventType.MOUSE_OUT, e => {\n      let relatedTarget = e.relatedTarget;\n      if (!isAncestor(relatedTarget, this.domNode)) {\n        this.focusedItem = undefined;\n        this.updateFocus();\n        e.stopPropagation();\n      }\n    }));\n    this._register(addDisposableListener(this.actionsList, EventType.MOUSE_OVER, e => {\n      let target = e.target;\n      if (!target || !isAncestor(target, this.actionsList) || target === this.actionsList) {\n        return;\n      }\n      while (target.parentElement !== this.actionsList && target.parentElement !== null) {\n        target = target.parentElement;\n      }\n      if (target.classList.contains('action-item')) {\n        const lastFocusedItem = this.focusedItem;\n        this.setFocusedItem(target);\n        if (lastFocusedItem !== this.focusedItem) {\n          this.updateFocus();\n        }\n      }\n    }));\n    let parentData = {\n      parent: this\n    };\n    this.mnemonics = new Map();\n    // Scroll Logic\n    this.scrollableElement = this._register(new DomScrollableElement(menuElement, {\n      alwaysConsumeMouseWheel: true,\n      horizontal: 2 /* Hidden */,\n      vertical: 3 /* Visible */,\n      verticalScrollbarSize: 7,\n      handleMouseWheel: true,\n      useShadows: true\n    }));\n    const scrollElement = this.scrollableElement.getDomNode();\n    scrollElement.style.position = '';\n    this._register(addDisposableListener(scrollElement, EventType.MOUSE_UP, e => {\n      // Absorb clicks in menu dead space https://github.com/microsoft/vscode/issues/63575\n      // We do this on the scroll element so the scroll bar doesn't dismiss the menu either\n      e.preventDefault();\n    }));\n    menuElement.style.maxHeight = \"\".concat(Math.max(10, window.innerHeight - container.getBoundingClientRect().top - 35), \"px\");\n    actions = actions.filter(a => {\n      var _a;\n      if ((_a = options.submenuIds) === null || _a === void 0 ? void 0 : _a.has(a.id)) {\n        console.warn(\"Found submenu cycle: \".concat(a.id));\n        return false;\n      }\n      return true;\n    });\n    this.push(actions, {\n      icon: true,\n      label: true,\n      isMenu: true\n    });\n    container.appendChild(this.scrollableElement.getDomNode());\n    this.scrollableElement.scanDomNode();\n    this.viewItems.filter(item => !(item instanceof MenuSeparatorActionViewItem)).forEach((item, index, array) => {\n      item.updatePositionInSet(index + 1, array.length);\n    });\n  }\n  initializeStyleSheet(container) {\n    if (isInShadowDOM(container)) {\n      this.styleSheet = createStyleSheet(container);\n      this.styleSheet.textContent = MENU_WIDGET_CSS;\n    } else {\n      if (!Menu.globalStyleSheet) {\n        Menu.globalStyleSheet = createStyleSheet();\n        Menu.globalStyleSheet.textContent = MENU_WIDGET_CSS;\n      }\n      this.styleSheet = Menu.globalStyleSheet;\n    }\n  }\n  style(style) {\n    const container = this.getContainer();\n    const fgColor = style.foregroundColor ? \"\".concat(style.foregroundColor) : '';\n    const bgColor = style.backgroundColor ? \"\".concat(style.backgroundColor) : '';\n    const border = style.borderColor ? \"1px solid \".concat(style.borderColor) : '';\n    const shadow = style.shadowColor ? \"0 2px 4px \".concat(style.shadowColor) : '';\n    container.style.border = border;\n    this.domNode.style.color = fgColor;\n    this.domNode.style.backgroundColor = bgColor;\n    container.style.boxShadow = shadow;\n    if (this.viewItems) {\n      this.viewItems.forEach(item => {\n        if (item instanceof BaseMenuActionViewItem || item instanceof MenuSeparatorActionViewItem) {\n          item.style(style);\n        }\n      });\n    }\n  }\n  getContainer() {\n    return this.scrollableElement.getDomNode();\n  }\n  get onScroll() {\n    return this.scrollableElement.onScroll;\n  }\n  focusItemByElement(element) {\n    const lastFocusedItem = this.focusedItem;\n    this.setFocusedItem(element);\n    if (lastFocusedItem !== this.focusedItem) {\n      this.updateFocus();\n    }\n  }\n  setFocusedItem(element) {\n    for (let i = 0; i < this.actionsList.children.length; i++) {\n      let elem = this.actionsList.children[i];\n      if (element === elem) {\n        this.focusedItem = i;\n        break;\n      }\n    }\n  }\n  updateFocus(fromRight) {\n    super.updateFocus(fromRight, true);\n    if (typeof this.focusedItem !== 'undefined') {\n      // Workaround for #80047 caused by an issue in chromium\n      // https://bugs.chromium.org/p/chromium/issues/detail?id=414283\n      // When that's fixed, just call this.scrollableElement.scanDomNode()\n      this.scrollableElement.setScrollPosition({\n        scrollTop: Math.round(this.menuElement.scrollTop)\n      });\n    }\n  }\n  doGetActionViewItem(action, options, parentData) {\n    if (action instanceof Separator) {\n      return new MenuSeparatorActionViewItem(options.context, action, {\n        icon: true\n      });\n    } else if (action instanceof SubmenuAction) {\n      const menuActionViewItem = new SubmenuMenuActionViewItem(action, action.actions, parentData, Object.assign(Object.assign({}, options), {\n        submenuIds: new Set([...(options.submenuIds || []), action.id])\n      }));\n      if (options.enableMnemonics) {\n        const mnemonic = menuActionViewItem.getMnemonic();\n        if (mnemonic && menuActionViewItem.isEnabled()) {\n          let actionViewItems = [];\n          if (this.mnemonics.has(mnemonic)) {\n            actionViewItems = this.mnemonics.get(mnemonic);\n          }\n          actionViewItems.push(menuActionViewItem);\n          this.mnemonics.set(mnemonic, actionViewItems);\n        }\n      }\n      return menuActionViewItem;\n    } else {\n      const menuItemOptions = {\n        enableMnemonics: options.enableMnemonics,\n        useEventAsContext: options.useEventAsContext\n      };\n      if (options.getKeyBinding) {\n        const keybinding = options.getKeyBinding(action);\n        if (keybinding) {\n          const keybindingLabel = keybinding.getLabel();\n          if (keybindingLabel) {\n            menuItemOptions.keybinding = keybindingLabel;\n          }\n        }\n      }\n      const menuActionViewItem = new BaseMenuActionViewItem(options.context, action, menuItemOptions);\n      if (options.enableMnemonics) {\n        const mnemonic = menuActionViewItem.getMnemonic();\n        if (mnemonic && menuActionViewItem.isEnabled()) {\n          let actionViewItems = [];\n          if (this.mnemonics.has(mnemonic)) {\n            actionViewItems = this.mnemonics.get(mnemonic);\n          }\n          actionViewItems.push(menuActionViewItem);\n          this.mnemonics.set(mnemonic, actionViewItems);\n        }\n      }\n      return menuActionViewItem;\n    }\n  }\n}\nclass BaseMenuActionViewItem extends BaseActionViewItem {\n  constructor(ctx, action) {\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    options.isMenu = true;\n    super(action, action, options);\n    this.options = options;\n    this.options.icon = options.icon !== undefined ? options.icon : false;\n    this.options.label = options.label !== undefined ? options.label : true;\n    this.cssClass = '';\n    // Set mnemonic\n    if (this.options.label && options.enableMnemonics) {\n      let label = this.getAction().label;\n      if (label) {\n        let matches = MENU_MNEMONIC_REGEX.exec(label);\n        if (matches) {\n          this.mnemonic = (!!matches[1] ? matches[1] : matches[3]).toLocaleLowerCase();\n        }\n      }\n    }\n    // Add mouse up listener later to avoid accidental clicks\n    this.runOnceToEnableMouseUp = new RunOnceScheduler(() => {\n      if (!this.element) {\n        return;\n      }\n      this._register(addDisposableListener(this.element, EventType.MOUSE_UP, e => {\n        // removed default prevention as it conflicts\n        // with BaseActionViewItem #101537\n        // add back if issues arise and link new issue\n        EventHelper.stop(e, true);\n        // See https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Interact_with_the_clipboard\n        // > Writing to the clipboard\n        // > You can use the \"cut\" and \"copy\" commands without any special\n        // permission if you are using them in a short-lived event handler\n        // for a user action (for example, a click handler).\n        // => to get the Copy and Paste context menu actions working on Firefox,\n        // there should be no timeout here\n        if (isFirefox) {\n          const mouseEvent = new StandardMouseEvent(e);\n          // Allowing right click to trigger the event causes the issue described below,\n          // but since the solution below does not work in FF, we must disable right click\n          if (mouseEvent.rightButton) {\n            return;\n          }\n          this.onClick(e);\n        }\n        // In all other cases, set timout to allow context menu cancellation to trigger\n        // otherwise the action will destroy the menu and a second context menu\n        // will still trigger for right click.\n        else {\n          setTimeout(() => {\n            this.onClick(e);\n          }, 0);\n        }\n      }));\n      this._register(addDisposableListener(this.element, EventType.CONTEXT_MENU, e => {\n        EventHelper.stop(e, true);\n      }));\n    }, 100);\n    this._register(this.runOnceToEnableMouseUp);\n  }\n  render(container) {\n    super.render(container);\n    if (!this.element) {\n      return;\n    }\n    this.container = container;\n    this.item = append(this.element, $('a.action-menu-item'));\n    if (this._action.id === Separator.ID) {\n      // A separator is a presentation item\n      this.item.setAttribute('role', 'presentation');\n    } else {\n      this.item.setAttribute('role', 'menuitem');\n      if (this.mnemonic) {\n        this.item.setAttribute('aria-keyshortcuts', \"\".concat(this.mnemonic));\n      }\n    }\n    this.check = append(this.item, $('span.menu-item-check' + menuSelectionIcon.cssSelector));\n    this.check.setAttribute('role', 'none');\n    this.label = append(this.item, $('span.action-label'));\n    if (this.options.label && this.options.keybinding) {\n      append(this.item, $('span.keybinding')).textContent = this.options.keybinding;\n    }\n    // Adds mouse up listener to actually run the action\n    this.runOnceToEnableMouseUp.schedule();\n    this.updateClass();\n    this.updateLabel();\n    this.updateTooltip();\n    this.updateEnabled();\n    this.updateChecked();\n  }\n  blur() {\n    super.blur();\n    this.applyStyle();\n  }\n  focus() {\n    super.focus();\n    if (this.item) {\n      this.item.focus();\n    }\n    this.applyStyle();\n  }\n  updatePositionInSet(pos, setSize) {\n    if (this.item) {\n      this.item.setAttribute('aria-posinset', \"\".concat(pos));\n      this.item.setAttribute('aria-setsize', \"\".concat(setSize));\n    }\n  }\n  updateLabel() {\n    if (!this.label) {\n      return;\n    }\n    if (this.options.label) {\n      clearNode(this.label);\n      let label = stripIcons(this.getAction().label);\n      if (label) {\n        const cleanLabel = cleanMnemonic(label);\n        if (!this.options.enableMnemonics) {\n          label = cleanLabel;\n        }\n        this.label.setAttribute('aria-label', cleanLabel.replace(/&&/g, '&'));\n        const matches = MENU_MNEMONIC_REGEX.exec(label);\n        if (matches) {\n          label = strings.escape(label);\n          // This is global, reset it\n          MENU_ESCAPED_MNEMONIC_REGEX.lastIndex = 0;\n          let escMatch = MENU_ESCAPED_MNEMONIC_REGEX.exec(label);\n          // We can't use negative lookbehind so if we match our negative and skip\n          while (escMatch && escMatch[1]) {\n            escMatch = MENU_ESCAPED_MNEMONIC_REGEX.exec(label);\n          }\n          const replaceDoubleEscapes = str => str.replace(/&amp;&amp;/g, '&amp;');\n          if (escMatch) {\n            this.label.append(strings.ltrim(replaceDoubleEscapes(label.substr(0, escMatch.index)), ' '), $('u', {\n              'aria-hidden': 'true'\n            }, escMatch[3]), strings.rtrim(replaceDoubleEscapes(label.substr(escMatch.index + escMatch[0].length)), ' '));\n          } else {\n            this.label.innerText = replaceDoubleEscapes(label).trim();\n          }\n          if (this.item) {\n            this.item.setAttribute('aria-keyshortcuts', (!!matches[1] ? matches[1] : matches[3]).toLocaleLowerCase());\n          }\n        } else {\n          this.label.innerText = label.replace(/&&/g, '&').trim();\n        }\n      }\n    }\n  }\n  updateTooltip() {\n    let title = null;\n    if (this.getAction().tooltip) {\n      title = this.getAction().tooltip;\n    } else if (!this.options.label && this.getAction().label && this.options.icon) {\n      title = this.getAction().label;\n      if (this.options.keybinding) {\n        title = nls.localize({\n          key: 'titleLabel',\n          comment: ['action title', 'action keybinding']\n        }, \"{0} ({1})\", title, this.options.keybinding);\n      }\n    }\n    if (title && this.item) {\n      this.item.title = title;\n    }\n  }\n  updateClass() {\n    if (this.cssClass && this.item) {\n      this.item.classList.remove(...this.cssClass.split(' '));\n    }\n    if (this.options.icon && this.label) {\n      this.cssClass = this.getAction().class || '';\n      this.label.classList.add('icon');\n      if (this.cssClass) {\n        this.label.classList.add(...this.cssClass.split(' '));\n      }\n      this.updateEnabled();\n    } else if (this.label) {\n      this.label.classList.remove('icon');\n    }\n  }\n  updateEnabled() {\n    if (this.getAction().enabled) {\n      if (this.element) {\n        this.element.classList.remove('disabled');\n      }\n      if (this.item) {\n        this.item.classList.remove('disabled');\n        this.item.tabIndex = 0;\n      }\n    } else {\n      if (this.element) {\n        this.element.classList.add('disabled');\n      }\n      if (this.item) {\n        this.item.classList.add('disabled');\n        removeTabIndexAndUpdateFocus(this.item);\n      }\n    }\n  }\n  updateChecked() {\n    if (!this.item) {\n      return;\n    }\n    if (this.getAction().checked) {\n      this.item.classList.add('checked');\n      this.item.setAttribute('role', 'menuitemcheckbox');\n      this.item.setAttribute('aria-checked', 'true');\n    } else {\n      this.item.classList.remove('checked');\n      this.item.setAttribute('role', 'menuitem');\n      this.item.setAttribute('aria-checked', 'false');\n    }\n  }\n  getMnemonic() {\n    return this.mnemonic;\n  }\n  applyStyle() {\n    if (!this.menuStyle) {\n      return;\n    }\n    const isSelected = this.element && this.element.classList.contains('focused');\n    const fgColor = isSelected && this.menuStyle.selectionForegroundColor ? this.menuStyle.selectionForegroundColor : this.menuStyle.foregroundColor;\n    const bgColor = isSelected && this.menuStyle.selectionBackgroundColor ? this.menuStyle.selectionBackgroundColor : undefined;\n    const border = isSelected && this.menuStyle.selectionBorderColor ? \"thin solid \".concat(this.menuStyle.selectionBorderColor) : '';\n    if (this.item) {\n      this.item.style.color = fgColor ? fgColor.toString() : '';\n      this.item.style.backgroundColor = bgColor ? bgColor.toString() : '';\n    }\n    if (this.check) {\n      this.check.style.color = fgColor ? fgColor.toString() : '';\n    }\n    if (this.container) {\n      this.container.style.border = border;\n    }\n  }\n  style(style) {\n    this.menuStyle = style;\n    this.applyStyle();\n  }\n}\nclass SubmenuMenuActionViewItem extends BaseMenuActionViewItem {\n  constructor(action, submenuActions, parentData, submenuOptions) {\n    super(action, action, submenuOptions);\n    this.submenuActions = submenuActions;\n    this.parentData = parentData;\n    this.submenuOptions = submenuOptions;\n    this.mysubmenu = null;\n    this.submenuDisposables = this._register(new DisposableStore());\n    this.mouseOver = false;\n    this.expandDirection = submenuOptions && submenuOptions.expandDirection !== undefined ? submenuOptions.expandDirection : Direction.Right;\n    this.showScheduler = new RunOnceScheduler(() => {\n      if (this.mouseOver) {\n        this.cleanupExistingSubmenu(false);\n        this.createSubmenu(false);\n      }\n    }, 250);\n    this.hideScheduler = new RunOnceScheduler(() => {\n      if (this.element && !isAncestor(getActiveElement(), this.element) && this.parentData.submenu === this.mysubmenu) {\n        this.parentData.parent.focus(false);\n        this.cleanupExistingSubmenu(true);\n      }\n    }, 750);\n  }\n  render(container) {\n    super.render(container);\n    if (!this.element) {\n      return;\n    }\n    if (this.item) {\n      this.item.classList.add('monaco-submenu-item');\n      this.item.tabIndex = 0;\n      this.item.setAttribute('aria-haspopup', 'true');\n      this.updateAriaExpanded('false');\n      this.submenuIndicator = append(this.item, $('span.submenu-indicator' + menuSubmenuIcon.cssSelector));\n      this.submenuIndicator.setAttribute('aria-hidden', 'true');\n    }\n    this._register(addDisposableListener(this.element, EventType.KEY_UP, e => {\n      let event = new StandardKeyboardEvent(e);\n      if (event.equals(17 /* RightArrow */) || event.equals(3 /* Enter */)) {\n        EventHelper.stop(e, true);\n        this.createSubmenu(true);\n      }\n    }));\n    this._register(addDisposableListener(this.element, EventType.KEY_DOWN, e => {\n      let event = new StandardKeyboardEvent(e);\n      if (getActiveElement() === this.item) {\n        if (event.equals(17 /* RightArrow */) || event.equals(3 /* Enter */)) {\n          EventHelper.stop(e, true);\n        }\n      }\n    }));\n    this._register(addDisposableListener(this.element, EventType.MOUSE_OVER, e => {\n      if (!this.mouseOver) {\n        this.mouseOver = true;\n        this.showScheduler.schedule();\n      }\n    }));\n    this._register(addDisposableListener(this.element, EventType.MOUSE_LEAVE, e => {\n      this.mouseOver = false;\n    }));\n    this._register(addDisposableListener(this.element, EventType.FOCUS_OUT, e => {\n      if (this.element && !isAncestor(getActiveElement(), this.element)) {\n        this.hideScheduler.schedule();\n      }\n    }));\n    this._register(this.parentData.parent.onScroll(() => {\n      this.parentData.parent.focus(false);\n      this.cleanupExistingSubmenu(false);\n    }));\n  }\n  updateEnabled() {\n    // override on submenu entry\n    // native menus do not observe enablement on sumbenus\n    // we mimic that behavior\n  }\n  onClick(e) {\n    // stop clicking from trying to run an action\n    EventHelper.stop(e, true);\n    this.cleanupExistingSubmenu(false);\n    this.createSubmenu(true);\n  }\n  cleanupExistingSubmenu(force) {\n    if (this.parentData.submenu && (force || this.parentData.submenu !== this.mysubmenu)) {\n      // disposal may throw if the submenu has already been removed\n      try {\n        this.parentData.submenu.dispose();\n      } catch (_a) {}\n      this.parentData.submenu = undefined;\n      this.updateAriaExpanded('false');\n      if (this.submenuContainer) {\n        this.submenuDisposables.clear();\n        this.submenuContainer = undefined;\n      }\n    }\n  }\n  calculateSubmenuMenuLayout(windowDimensions, submenu, entry, expandDirection) {\n    const ret = {\n      top: 0,\n      left: 0\n    };\n    // Start with horizontal\n    ret.left = layout(windowDimensions.width, submenu.width, {\n      position: expandDirection === Direction.Right ? 0 /* Before */ : 1 /* After */,\n      offset: entry.left,\n      size: entry.width\n    });\n    // We don't have enough room to layout the menu fully, so we are overlapping the menu\n    if (ret.left >= entry.left && ret.left < entry.left + entry.width) {\n      if (entry.left + 10 + submenu.width <= windowDimensions.width) {\n        ret.left = entry.left + 10;\n      }\n      entry.top += 10;\n      entry.height = 0;\n    }\n    // Now that we have a horizontal position, try layout vertically\n    ret.top = layout(windowDimensions.height, submenu.height, {\n      position: 0 /* Before */,\n      offset: entry.top,\n      size: 0\n    });\n    // We didn't have enough room below, but we did above, so we shift down to align the menu\n    if (ret.top + submenu.height === entry.top && ret.top + entry.height + submenu.height <= windowDimensions.height) {\n      ret.top += entry.height;\n    }\n    return ret;\n  }\n  createSubmenu() {\n    let selectFirstItem = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n    if (!this.element) {\n      return;\n    }\n    if (!this.parentData.submenu) {\n      this.updateAriaExpanded('true');\n      this.submenuContainer = append(this.element, $('div.monaco-submenu'));\n      this.submenuContainer.classList.add('menubar-menu-items-holder', 'context-view');\n      // Set the top value of the menu container before construction\n      // This allows the menu constructor to calculate the proper max height\n      const computedStyles = getComputedStyle(this.parentData.parent.domNode);\n      const paddingTop = parseFloat(computedStyles.paddingTop || '0') || 0;\n      // this.submenuContainer.style.top = `${this.element.offsetTop - this.parentData.parent.scrollOffset - paddingTop}px`;\n      this.submenuContainer.style.zIndex = '1';\n      this.submenuContainer.style.position = 'fixed';\n      this.submenuContainer.style.top = '0';\n      this.submenuContainer.style.left = '0';\n      this.parentData.submenu = new Menu(this.submenuContainer, this.submenuActions.length ? this.submenuActions : [new EmptySubmenuAction()], this.submenuOptions);\n      if (this.menuStyle) {\n        this.parentData.submenu.style(this.menuStyle);\n      }\n      // layout submenu\n      const entryBox = this.element.getBoundingClientRect();\n      const entryBoxUpdated = {\n        top: entryBox.top - paddingTop,\n        left: entryBox.left,\n        height: entryBox.height + 2 * paddingTop,\n        width: entryBox.width\n      };\n      const viewBox = this.submenuContainer.getBoundingClientRect();\n      const {\n        top,\n        left\n      } = this.calculateSubmenuMenuLayout(new Dimension(window.innerWidth, window.innerHeight), Dimension.lift(viewBox), entryBoxUpdated, this.expandDirection);\n      this.submenuContainer.style.left = \"\".concat(left, \"px\");\n      this.submenuContainer.style.top = \"\".concat(top, \"px\");\n      this.submenuDisposables.add(addDisposableListener(this.submenuContainer, EventType.KEY_UP, e => {\n        let event = new StandardKeyboardEvent(e);\n        if (event.equals(15 /* LeftArrow */)) {\n          EventHelper.stop(e, true);\n          this.parentData.parent.focus();\n          this.cleanupExistingSubmenu(true);\n        }\n      }));\n      this.submenuDisposables.add(addDisposableListener(this.submenuContainer, EventType.KEY_DOWN, e => {\n        let event = new StandardKeyboardEvent(e);\n        if (event.equals(15 /* LeftArrow */)) {\n          EventHelper.stop(e, true);\n        }\n      }));\n      this.submenuDisposables.add(this.parentData.submenu.onDidCancel(() => {\n        this.parentData.parent.focus();\n        this.cleanupExistingSubmenu(true);\n      }));\n      this.parentData.submenu.focus(selectFirstItem);\n      this.mysubmenu = this.parentData.submenu;\n    } else {\n      this.parentData.submenu.focus(false);\n    }\n  }\n  updateAriaExpanded(value) {\n    var _a;\n    if (this.item) {\n      (_a = this.item) === null || _a === void 0 ? void 0 : _a.setAttribute('aria-expanded', value);\n    }\n  }\n  applyStyle() {\n    super.applyStyle();\n    if (!this.menuStyle) {\n      return;\n    }\n    const isSelected = this.element && this.element.classList.contains('focused');\n    const fgColor = isSelected && this.menuStyle.selectionForegroundColor ? this.menuStyle.selectionForegroundColor : this.menuStyle.foregroundColor;\n    if (this.submenuIndicator) {\n      this.submenuIndicator.style.color = fgColor ? \"\".concat(fgColor) : '';\n    }\n    if (this.parentData.submenu) {\n      this.parentData.submenu.style(this.menuStyle);\n    }\n  }\n  dispose() {\n    super.dispose();\n    this.hideScheduler.dispose();\n    if (this.mysubmenu) {\n      this.mysubmenu.dispose();\n      this.mysubmenu = null;\n    }\n    if (this.submenuContainer) {\n      this.submenuContainer = undefined;\n    }\n  }\n}\nclass MenuSeparatorActionViewItem extends ActionViewItem {\n  style(style) {\n    if (this.label) {\n      this.label.style.borderBottomColor = style.separatorColor ? \"\".concat(style.separatorColor) : '';\n    }\n  }\n}\nexport function cleanMnemonic(label) {\n  const regex = MENU_MNEMONIC_REGEX;\n  const matches = regex.exec(label);\n  if (!matches) {\n    return label;\n  }\n  const mnemonicInText = !matches[1];\n  return label.replace(regex, mnemonicInText ? '$2$3' : '').trim();\n}\nlet MENU_WIDGET_CSS = \"\\n.monaco-menu {\\n\\tfont-size: 13px;\\n\\n}\\n\\n\".concat(formatRule(menuSelectionIcon), \"\\n\").concat(formatRule(menuSubmenuIcon), \"\\n\\n.monaco-menu .monaco-action-bar {\\n\\ttext-align: right;\\n\\toverflow: hidden;\\n\\twhite-space: nowrap;\\n}\\n\\n.monaco-menu .monaco-action-bar .actions-container {\\n\\tdisplay: flex;\\n\\tmargin: 0 auto;\\n\\tpadding: 0;\\n\\twidth: 100%;\\n\\tjustify-content: flex-end;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .actions-container {\\n\\tdisplay: inline-block;\\n}\\n\\n.monaco-menu .monaco-action-bar.reverse .actions-container {\\n\\tflex-direction: row-reverse;\\n}\\n\\n.monaco-menu .monaco-action-bar .action-item {\\n\\tcursor: pointer;\\n\\tdisplay: inline-block;\\n\\ttransition: transform 50ms ease;\\n\\tposition: relative;  /* DO NOT REMOVE - this is the key to preventing the ghosting icon bug in Chrome 42 */\\n}\\n\\n.monaco-menu .monaco-action-bar .action-item.disabled {\\n\\tcursor: default;\\n}\\n\\n.monaco-menu .monaco-action-bar.animated .action-item.active {\\n\\ttransform: scale(1.272019649, 1.272019649); /* 1.272019649 = \\u221A\\u03C6 */\\n}\\n\\n.monaco-menu .monaco-action-bar .action-item .icon,\\n.monaco-menu .monaco-action-bar .action-item .codicon {\\n\\tdisplay: inline-block;\\n}\\n\\n.monaco-menu .monaco-action-bar .action-item .codicon {\\n\\tdisplay: flex;\\n\\talign-items: center;\\n}\\n\\n.monaco-menu .monaco-action-bar .action-label {\\n\\tfont-size: 11px;\\n\\tmargin-right: 4px;\\n}\\n\\n.monaco-menu .monaco-action-bar .action-item.disabled .action-label,\\n.monaco-menu .monaco-action-bar .action-item.disabled .action-label:hover {\\n\\topacity: 0.4;\\n}\\n\\n/* Vertical actions */\\n\\n.monaco-menu .monaco-action-bar.vertical {\\n\\ttext-align: left;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .action-item {\\n\\tdisplay: block;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .action-label.separator {\\n\\tdisplay: block;\\n\\tborder-bottom: 1px solid #bbb;\\n\\tpadding-top: 1px;\\n\\tmargin-left: .8em;\\n\\tmargin-right: .8em;\\n}\\n\\n.monaco-menu .secondary-actions .monaco-action-bar .action-label {\\n\\tmargin-left: 6px;\\n}\\n\\n/* Action Items */\\n.monaco-menu .monaco-action-bar .action-item.select-container {\\n\\toverflow: hidden; /* somehow the dropdown overflows its container, we prevent it here to not push */\\n\\tflex: 1;\\n\\tmax-width: 170px;\\n\\tmin-width: 60px;\\n\\tdisplay: flex;\\n\\talign-items: center;\\n\\tjustify-content: center;\\n\\tmargin-right: 10px;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical {\\n\\tmargin-left: 0;\\n\\toverflow: visible;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .actions-container {\\n\\tdisplay: block;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .action-item {\\n\\tpadding: 0;\\n\\ttransform: none;\\n\\tdisplay: flex;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .action-item.active {\\n\\ttransform: none;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .action-menu-item {\\n\\tflex: 1 1 auto;\\n\\tdisplay: flex;\\n\\theight: 2em;\\n\\talign-items: center;\\n\\tposition: relative;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .action-label {\\n\\tflex: 1 1 auto;\\n\\ttext-decoration: none;\\n\\tpadding: 0 1em;\\n\\tbackground: none;\\n\\tfont-size: 12px;\\n\\tline-height: 1;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .keybinding,\\n.monaco-menu .monaco-action-bar.vertical .submenu-indicator {\\n\\tdisplay: inline-block;\\n\\tflex: 2 1 auto;\\n\\tpadding: 0 1em;\\n\\ttext-align: right;\\n\\tfont-size: 12px;\\n\\tline-height: 1;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .submenu-indicator {\\n\\theight: 100%;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .submenu-indicator.codicon {\\n\\tfont-size: 16px !important;\\n\\tdisplay: flex;\\n\\talign-items: center;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .submenu-indicator.codicon::before {\\n\\tmargin-left: auto;\\n\\tmargin-right: -20px;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .action-item.disabled .keybinding,\\n.monaco-menu .monaco-action-bar.vertical .action-item.disabled .submenu-indicator {\\n\\topacity: 0.4;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .action-label:not(.separator) {\\n\\tdisplay: inline-block;\\n\\tbox-sizing: border-box;\\n\\tmargin: 0;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .action-item {\\n\\tposition: static;\\n\\toverflow: visible;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .action-item .monaco-submenu {\\n\\tposition: absolute;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .action-label.separator {\\n\\tpadding: 0.5em 0 0 0;\\n\\tmargin-bottom: 0.5em;\\n\\twidth: 100%;\\n\\theight: 0px !important;\\n\\tmargin-left: .8em !important;\\n\\tmargin-right: .8em !important;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .action-label.separator.text {\\n\\tpadding: 0.7em 1em 0.1em 1em;\\n\\tfont-weight: bold;\\n\\topacity: 1;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .action-label:hover {\\n\\tcolor: inherit;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .menu-item-check {\\n\\tposition: absolute;\\n\\tvisibility: hidden;\\n\\twidth: 1em;\\n\\theight: 100%;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .action-menu-item.checked .menu-item-check {\\n\\tvisibility: visible;\\n\\tdisplay: flex;\\n\\talign-items: center;\\n\\tjustify-content: center;\\n}\\n\\n/* Context Menu */\\n\\n.context-view.monaco-menu-container {\\n\\toutline: 0;\\n\\tborder: none;\\n\\tanimation: fadeIn 0.083s linear;\\n\\t-webkit-app-region: no-drag;\\n}\\n\\n.context-view.monaco-menu-container :focus,\\n.context-view.monaco-menu-container .monaco-action-bar.vertical:focus,\\n.context-view.monaco-menu-container .monaco-action-bar.vertical :focus {\\n\\toutline: 0;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .action-item {\\n\\tborder: thin solid transparent; /* prevents jumping behaviour on hover or focus */\\n}\\n\\n\\n/* High Contrast Theming */\\n:host-context(.hc-black) .context-view.monaco-menu-container {\\n\\tbox-shadow: none;\\n}\\n\\n:host-context(.hc-black) .monaco-menu .monaco-action-bar.vertical .action-item.focused {\\n\\tbackground: none;\\n}\\n\\n/* Vertical Action Bar Styles */\\n\\n.monaco-menu .monaco-action-bar.vertical {\\n\\tpadding: .5em 0;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .action-menu-item {\\n\\theight: 1.8em;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .action-label:not(.separator),\\n.monaco-menu .monaco-action-bar.vertical .keybinding {\\n\\tfont-size: inherit;\\n\\tpadding: 0 2em;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .menu-item-check {\\n\\tfont-size: inherit;\\n\\twidth: 2em;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .action-label.separator {\\n\\tfont-size: inherit;\\n\\tpadding: 0.2em 0 0 0;\\n\\tmargin-bottom: 0.2em;\\n}\\n\\n:host-context(.linux) .monaco-menu .monaco-action-bar.vertical .action-label.separator {\\n\\tmargin-left: 0;\\n\\tmargin-right: 0;\\n}\\n\\n.monaco-menu .monaco-action-bar.vertical .submenu-indicator {\\n\\tfont-size: 60%;\\n\\tpadding: 0 1.8em;\\n}\\n\\n:host-context(.linux) .monaco-menu .monaco-action-bar.vertical .submenu-indicator {\\n\\theight: 100%;\\n\\tmask-size: 10px 10px;\\n\\t-webkit-mask-size: 10px 10px;\\n}\\n\\n.monaco-menu .action-item {\\n\\tcursor: default;\\n}\\n\\n/* Arrows */\\n.monaco-scrollable-element > .scrollbar > .scra {\\n\\tcursor: pointer;\\n\\tfont-size: 11px !important;\\n}\\n\\n.monaco-scrollable-element > .visible {\\n\\topacity: 1;\\n\\n\\t/* Background rule added for IE9 - to allow clicks on dom node */\\n\\tbackground:rgba(0,0,0,0);\\n\\n\\ttransition: opacity 100ms linear;\\n}\\n.monaco-scrollable-element > .invisible {\\n\\topacity: 0;\\n\\tpointer-events: none;\\n}\\n.monaco-scrollable-element > .invisible.fade {\\n\\ttransition: opacity 800ms linear;\\n}\\n\\n/* Scrollable Content Inset Shadow */\\n.monaco-scrollable-element > .shadow {\\n\\tposition: absolute;\\n\\tdisplay: none;\\n}\\n.monaco-scrollable-element > .shadow.top {\\n\\tdisplay: block;\\n\\ttop: 0;\\n\\tleft: 3px;\\n\\theight: 3px;\\n\\twidth: 100%;\\n\\tbox-shadow: #DDD 0 6px 6px -6px inset;\\n}\\n.monaco-scrollable-element > .shadow.left {\\n\\tdisplay: block;\\n\\ttop: 3px;\\n\\tleft: 0;\\n\\theight: 100%;\\n\\twidth: 3px;\\n\\tbox-shadow: #DDD 6px 0 6px -6px inset;\\n}\\n.monaco-scrollable-element > .shadow.top-left-corner {\\n\\tdisplay: block;\\n\\ttop: 0;\\n\\tleft: 0;\\n\\theight: 3px;\\n\\twidth: 3px;\\n}\\n.monaco-scrollable-element > .shadow.top.left {\\n\\tbox-shadow: #DDD 6px 6px 6px -6px inset;\\n}\\n\\n/* ---------- Default Style ---------- */\\n\\n:host-context(.vs) .monaco-scrollable-element > .scrollbar > .slider {\\n\\tbackground: rgba(100, 100, 100, .4);\\n}\\n:host-context(.vs-dark) .monaco-scrollable-element > .scrollbar > .slider {\\n\\tbackground: rgba(121, 121, 121, .4);\\n}\\n:host-context(.hc-black) .monaco-scrollable-element > .scrollbar > .slider {\\n\\tbackground: rgba(111, 195, 223, .6);\\n}\\n\\n.monaco-scrollable-element > .scrollbar > .slider:hover {\\n\\tbackground: rgba(100, 100, 100, .7);\\n}\\n:host-context(.hc-black) .monaco-scrollable-element > .scrollbar > .slider:hover {\\n\\tbackground: rgba(111, 195, 223, .8);\\n}\\n\\n.monaco-scrollable-element > .scrollbar > .slider.active {\\n\\tbackground: rgba(0, 0, 0, .6);\\n}\\n:host-context(.vs-dark) .monaco-scrollable-element > .scrollbar > .slider.active {\\n\\tbackground: rgba(191, 191, 191, .4);\\n}\\n:host-context(.hc-black) .monaco-scrollable-element > .scrollbar > .slider.active {\\n\\tbackground: rgba(111, 195, 223, 1);\\n}\\n\\n:host-context(.vs-dark) .monaco-scrollable-element .shadow.top {\\n\\tbox-shadow: none;\\n}\\n\\n:host-context(.vs-dark) .monaco-scrollable-element .shadow.left {\\n\\tbox-shadow: #000 6px 0 6px -6px inset;\\n}\\n\\n:host-context(.vs-dark) .monaco-scrollable-element .shadow.top.left {\\n\\tbox-shadow: #000 6px 6px 6px -6px inset;\\n}\\n\\n:host-context(.hc-black) .monaco-scrollable-element .shadow.top {\\n\\tbox-shadow: none;\\n}\\n\\n:host-context(.hc-black) .monaco-scrollable-element .shadow.left {\\n\\tbox-shadow: none;\\n}\\n\\n:host-context(.hc-black) .monaco-scrollable-element .shadow.top.left {\\n\\tbox-shadow: none;\\n}\\n\");","map":{"version":3,"names":["nls","strings","SubmenuAction","Separator","EmptySubmenuAction","ActionBar","EventType","EventHelper","removeTabIndexAndUpdateFocus","isAncestor","addDisposableListener","append","$","clearNode","createStyleSheet","isInShadowDOM","getActiveElement","Dimension","StandardKeyboardEvent","RunOnceScheduler","DisposableStore","DomScrollableElement","layout","isLinux","isMacintosh","Codicon","registerCodicon","BaseActionViewItem","ActionViewItem","formatRule","isFirefox","StandardMouseEvent","stripIcons","MENU_MNEMONIC_REGEX","MENU_ESCAPED_MNEMONIC_REGEX","menuSelectionIcon","check","menuSubmenuIcon","chevronRight","Direction","Menu","constructor","container","actions","options","arguments","length","undefined","classList","add","setAttribute","menuElement","document","createElement","orientation","actionViewItemProvider","action","doGetActionViewItem","parentData","context","actionRunner","ariaLabel","triggerKeys","keys","keyDown","actionsList","tabIndex","menuDisposables","_register","initializeStyleSheet","KEY_DOWN","e","event","equals","preventDefault","enableMnemonics","key","toLocaleLowerCase","mnemonics","has","stop","get","SubmenuMenuActionViewItem","focusItemByElement","onClick","shift","push","set","focusedItem","viewItems","focusNext","focusPrevious","domNode","MOUSE_OUT","relatedTarget","updateFocus","stopPropagation","MOUSE_OVER","target","parentElement","contains","lastFocusedItem","setFocusedItem","parent","Map","scrollableElement","alwaysConsumeMouseWheel","horizontal","vertical","verticalScrollbarSize","handleMouseWheel","useShadows","scrollElement","getDomNode","style","position","MOUSE_UP","maxHeight","concat","Math","max","window","innerHeight","getBoundingClientRect","top","filter","a","_a","submenuIds","id","console","warn","icon","label","isMenu","appendChild","scanDomNode","item","MenuSeparatorActionViewItem","forEach","index","array","updatePositionInSet","styleSheet","textContent","MENU_WIDGET_CSS","globalStyleSheet","getContainer","fgColor","foregroundColor","bgColor","backgroundColor","border","borderColor","shadow","shadowColor","color","boxShadow","BaseMenuActionViewItem","onScroll","element","i","children","elem","fromRight","setScrollPosition","scrollTop","round","menuActionViewItem","Object","assign","Set","mnemonic","getMnemonic","isEnabled","actionViewItems","menuItemOptions","useEventAsContext","getKeyBinding","keybinding","keybindingLabel","getLabel","ctx","cssClass","getAction","matches","exec","runOnceToEnableMouseUp","mouseEvent","rightButton","setTimeout","CONTEXT_MENU","render","_action","ID","cssSelector","schedule","updateClass","updateLabel","updateTooltip","updateEnabled","updateChecked","blur","applyStyle","focus","pos","setSize","cleanLabel","cleanMnemonic","replace","escape","lastIndex","escMatch","replaceDoubleEscapes","str","ltrim","substr","rtrim","innerText","trim","title","tooltip","localize","comment","remove","split","class","enabled","checked","menuStyle","isSelected","selectionForegroundColor","selectionBackgroundColor","selectionBorderColor","toString","submenuActions","submenuOptions","mysubmenu","submenuDisposables","mouseOver","expandDirection","Right","showScheduler","cleanupExistingSubmenu","createSubmenu","hideScheduler","submenu","updateAriaExpanded","submenuIndicator","KEY_UP","MOUSE_LEAVE","FOCUS_OUT","force","dispose","submenuContainer","clear","calculateSubmenuMenuLayout","windowDimensions","entry","ret","left","width","offset","size","height","selectFirstItem","computedStyles","getComputedStyle","paddingTop","parseFloat","zIndex","entryBox","entryBoxUpdated","viewBox","innerWidth","lift","onDidCancel","value","borderBottomColor","separatorColor","regex","mnemonicInText"],"sources":["C:/Users/Administrator/Desktop/sqllineage-master/sqllineagejs/node_modules/monaco-editor/esm/vs/base/browser/ui/menu/menu.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport * as nls from '../../../../nls.js';\r\nimport * as strings from '../../../common/strings.js';\r\nimport { SubmenuAction, Separator, EmptySubmenuAction } from '../../../common/actions.js';\r\nimport { ActionBar } from '../actionbar/actionbar.js';\r\nimport { EventType, EventHelper, removeTabIndexAndUpdateFocus, isAncestor, addDisposableListener, append, $, clearNode, createStyleSheet, isInShadowDOM, getActiveElement, Dimension } from '../../dom.js';\r\nimport { StandardKeyboardEvent } from '../../keyboardEvent.js';\r\nimport { RunOnceScheduler } from '../../../common/async.js';\r\nimport { DisposableStore } from '../../../common/lifecycle.js';\r\nimport { DomScrollableElement } from '../scrollbar/scrollableElement.js';\r\nimport { layout } from '../contextview/contextview.js';\r\nimport { isLinux, isMacintosh } from '../../../common/platform.js';\r\nimport { Codicon, registerCodicon } from '../../../common/codicons.js';\r\nimport { BaseActionViewItem, ActionViewItem } from '../actionbar/actionViewItems.js';\r\nimport { formatRule } from '../codicons/codiconStyles.js';\r\nimport { isFirefox } from '../../browser.js';\r\nimport { StandardMouseEvent } from '../../mouseEvent.js';\r\nimport { stripIcons } from '../../../common/iconLabels.js';\r\nexport const MENU_MNEMONIC_REGEX = /\\(&([^\\s&])\\)|(^|[^&])&([^\\s&])/;\r\nexport const MENU_ESCAPED_MNEMONIC_REGEX = /(&amp;)?(&amp;)([^\\s&])/g;\r\nconst menuSelectionIcon = registerCodicon('menu-selection', Codicon.check);\r\nconst menuSubmenuIcon = registerCodicon('menu-submenu', Codicon.chevronRight);\r\nexport var Direction;\r\n(function (Direction) {\r\n    Direction[Direction[\"Right\"] = 0] = \"Right\";\r\n    Direction[Direction[\"Left\"] = 1] = \"Left\";\r\n})(Direction || (Direction = {}));\r\nexport class Menu extends ActionBar {\r\n    constructor(container, actions, options = {}) {\r\n        container.classList.add('monaco-menu-container');\r\n        container.setAttribute('role', 'presentation');\r\n        const menuElement = document.createElement('div');\r\n        menuElement.classList.add('monaco-menu');\r\n        menuElement.setAttribute('role', 'presentation');\r\n        super(menuElement, {\r\n            orientation: 2 /* VERTICAL */,\r\n            actionViewItemProvider: action => this.doGetActionViewItem(action, options, parentData),\r\n            context: options.context,\r\n            actionRunner: options.actionRunner,\r\n            ariaLabel: options.ariaLabel,\r\n            triggerKeys: { keys: [3 /* Enter */, ...(isMacintosh || isLinux ? [10 /* Space */] : [])], keyDown: true }\r\n        });\r\n        this.menuElement = menuElement;\r\n        this.actionsList.setAttribute('role', 'menu');\r\n        this.actionsList.tabIndex = 0;\r\n        this.menuDisposables = this._register(new DisposableStore());\r\n        this.initializeStyleSheet(container);\r\n        addDisposableListener(menuElement, EventType.KEY_DOWN, (e) => {\r\n            const event = new StandardKeyboardEvent(e);\r\n            // Stop tab navigation of menus\r\n            if (event.equals(2 /* Tab */)) {\r\n                e.preventDefault();\r\n            }\r\n        });\r\n        if (options.enableMnemonics) {\r\n            this.menuDisposables.add(addDisposableListener(menuElement, EventType.KEY_DOWN, (e) => {\r\n                const key = e.key.toLocaleLowerCase();\r\n                if (this.mnemonics.has(key)) {\r\n                    EventHelper.stop(e, true);\r\n                    const actions = this.mnemonics.get(key);\r\n                    if (actions.length === 1) {\r\n                        if (actions[0] instanceof SubmenuMenuActionViewItem && actions[0].container) {\r\n                            this.focusItemByElement(actions[0].container);\r\n                        }\r\n                        actions[0].onClick(e);\r\n                    }\r\n                    if (actions.length > 1) {\r\n                        const action = actions.shift();\r\n                        if (action && action.container) {\r\n                            this.focusItemByElement(action.container);\r\n                            actions.push(action);\r\n                        }\r\n                        this.mnemonics.set(key, actions);\r\n                    }\r\n                }\r\n            }));\r\n        }\r\n        if (isLinux) {\r\n            this._register(addDisposableListener(menuElement, EventType.KEY_DOWN, e => {\r\n                const event = new StandardKeyboardEvent(e);\r\n                if (event.equals(14 /* Home */) || event.equals(11 /* PageUp */)) {\r\n                    this.focusedItem = this.viewItems.length - 1;\r\n                    this.focusNext();\r\n                    EventHelper.stop(e, true);\r\n                }\r\n                else if (event.equals(13 /* End */) || event.equals(12 /* PageDown */)) {\r\n                    this.focusedItem = 0;\r\n                    this.focusPrevious();\r\n                    EventHelper.stop(e, true);\r\n                }\r\n            }));\r\n        }\r\n        this._register(addDisposableListener(this.domNode, EventType.MOUSE_OUT, e => {\r\n            let relatedTarget = e.relatedTarget;\r\n            if (!isAncestor(relatedTarget, this.domNode)) {\r\n                this.focusedItem = undefined;\r\n                this.updateFocus();\r\n                e.stopPropagation();\r\n            }\r\n        }));\r\n        this._register(addDisposableListener(this.actionsList, EventType.MOUSE_OVER, e => {\r\n            let target = e.target;\r\n            if (!target || !isAncestor(target, this.actionsList) || target === this.actionsList) {\r\n                return;\r\n            }\r\n            while (target.parentElement !== this.actionsList && target.parentElement !== null) {\r\n                target = target.parentElement;\r\n            }\r\n            if (target.classList.contains('action-item')) {\r\n                const lastFocusedItem = this.focusedItem;\r\n                this.setFocusedItem(target);\r\n                if (lastFocusedItem !== this.focusedItem) {\r\n                    this.updateFocus();\r\n                }\r\n            }\r\n        }));\r\n        let parentData = {\r\n            parent: this\r\n        };\r\n        this.mnemonics = new Map();\r\n        // Scroll Logic\r\n        this.scrollableElement = this._register(new DomScrollableElement(menuElement, {\r\n            alwaysConsumeMouseWheel: true,\r\n            horizontal: 2 /* Hidden */,\r\n            vertical: 3 /* Visible */,\r\n            verticalScrollbarSize: 7,\r\n            handleMouseWheel: true,\r\n            useShadows: true\r\n        }));\r\n        const scrollElement = this.scrollableElement.getDomNode();\r\n        scrollElement.style.position = '';\r\n        this._register(addDisposableListener(scrollElement, EventType.MOUSE_UP, e => {\r\n            // Absorb clicks in menu dead space https://github.com/microsoft/vscode/issues/63575\r\n            // We do this on the scroll element so the scroll bar doesn't dismiss the menu either\r\n            e.preventDefault();\r\n        }));\r\n        menuElement.style.maxHeight = `${Math.max(10, window.innerHeight - container.getBoundingClientRect().top - 35)}px`;\r\n        actions = actions.filter(a => {\r\n            var _a;\r\n            if ((_a = options.submenuIds) === null || _a === void 0 ? void 0 : _a.has(a.id)) {\r\n                console.warn(`Found submenu cycle: ${a.id}`);\r\n                return false;\r\n            }\r\n            return true;\r\n        });\r\n        this.push(actions, { icon: true, label: true, isMenu: true });\r\n        container.appendChild(this.scrollableElement.getDomNode());\r\n        this.scrollableElement.scanDomNode();\r\n        this.viewItems.filter(item => !(item instanceof MenuSeparatorActionViewItem)).forEach((item, index, array) => {\r\n            item.updatePositionInSet(index + 1, array.length);\r\n        });\r\n    }\r\n    initializeStyleSheet(container) {\r\n        if (isInShadowDOM(container)) {\r\n            this.styleSheet = createStyleSheet(container);\r\n            this.styleSheet.textContent = MENU_WIDGET_CSS;\r\n        }\r\n        else {\r\n            if (!Menu.globalStyleSheet) {\r\n                Menu.globalStyleSheet = createStyleSheet();\r\n                Menu.globalStyleSheet.textContent = MENU_WIDGET_CSS;\r\n            }\r\n            this.styleSheet = Menu.globalStyleSheet;\r\n        }\r\n    }\r\n    style(style) {\r\n        const container = this.getContainer();\r\n        const fgColor = style.foregroundColor ? `${style.foregroundColor}` : '';\r\n        const bgColor = style.backgroundColor ? `${style.backgroundColor}` : '';\r\n        const border = style.borderColor ? `1px solid ${style.borderColor}` : '';\r\n        const shadow = style.shadowColor ? `0 2px 4px ${style.shadowColor}` : '';\r\n        container.style.border = border;\r\n        this.domNode.style.color = fgColor;\r\n        this.domNode.style.backgroundColor = bgColor;\r\n        container.style.boxShadow = shadow;\r\n        if (this.viewItems) {\r\n            this.viewItems.forEach(item => {\r\n                if (item instanceof BaseMenuActionViewItem || item instanceof MenuSeparatorActionViewItem) {\r\n                    item.style(style);\r\n                }\r\n            });\r\n        }\r\n    }\r\n    getContainer() {\r\n        return this.scrollableElement.getDomNode();\r\n    }\r\n    get onScroll() {\r\n        return this.scrollableElement.onScroll;\r\n    }\r\n    focusItemByElement(element) {\r\n        const lastFocusedItem = this.focusedItem;\r\n        this.setFocusedItem(element);\r\n        if (lastFocusedItem !== this.focusedItem) {\r\n            this.updateFocus();\r\n        }\r\n    }\r\n    setFocusedItem(element) {\r\n        for (let i = 0; i < this.actionsList.children.length; i++) {\r\n            let elem = this.actionsList.children[i];\r\n            if (element === elem) {\r\n                this.focusedItem = i;\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    updateFocus(fromRight) {\r\n        super.updateFocus(fromRight, true);\r\n        if (typeof this.focusedItem !== 'undefined') {\r\n            // Workaround for #80047 caused by an issue in chromium\r\n            // https://bugs.chromium.org/p/chromium/issues/detail?id=414283\r\n            // When that's fixed, just call this.scrollableElement.scanDomNode()\r\n            this.scrollableElement.setScrollPosition({\r\n                scrollTop: Math.round(this.menuElement.scrollTop)\r\n            });\r\n        }\r\n    }\r\n    doGetActionViewItem(action, options, parentData) {\r\n        if (action instanceof Separator) {\r\n            return new MenuSeparatorActionViewItem(options.context, action, { icon: true });\r\n        }\r\n        else if (action instanceof SubmenuAction) {\r\n            const menuActionViewItem = new SubmenuMenuActionViewItem(action, action.actions, parentData, Object.assign(Object.assign({}, options), { submenuIds: new Set([...(options.submenuIds || []), action.id]) }));\r\n            if (options.enableMnemonics) {\r\n                const mnemonic = menuActionViewItem.getMnemonic();\r\n                if (mnemonic && menuActionViewItem.isEnabled()) {\r\n                    let actionViewItems = [];\r\n                    if (this.mnemonics.has(mnemonic)) {\r\n                        actionViewItems = this.mnemonics.get(mnemonic);\r\n                    }\r\n                    actionViewItems.push(menuActionViewItem);\r\n                    this.mnemonics.set(mnemonic, actionViewItems);\r\n                }\r\n            }\r\n            return menuActionViewItem;\r\n        }\r\n        else {\r\n            const menuItemOptions = { enableMnemonics: options.enableMnemonics, useEventAsContext: options.useEventAsContext };\r\n            if (options.getKeyBinding) {\r\n                const keybinding = options.getKeyBinding(action);\r\n                if (keybinding) {\r\n                    const keybindingLabel = keybinding.getLabel();\r\n                    if (keybindingLabel) {\r\n                        menuItemOptions.keybinding = keybindingLabel;\r\n                    }\r\n                }\r\n            }\r\n            const menuActionViewItem = new BaseMenuActionViewItem(options.context, action, menuItemOptions);\r\n            if (options.enableMnemonics) {\r\n                const mnemonic = menuActionViewItem.getMnemonic();\r\n                if (mnemonic && menuActionViewItem.isEnabled()) {\r\n                    let actionViewItems = [];\r\n                    if (this.mnemonics.has(mnemonic)) {\r\n                        actionViewItems = this.mnemonics.get(mnemonic);\r\n                    }\r\n                    actionViewItems.push(menuActionViewItem);\r\n                    this.mnemonics.set(mnemonic, actionViewItems);\r\n                }\r\n            }\r\n            return menuActionViewItem;\r\n        }\r\n    }\r\n}\r\nclass BaseMenuActionViewItem extends BaseActionViewItem {\r\n    constructor(ctx, action, options = {}) {\r\n        options.isMenu = true;\r\n        super(action, action, options);\r\n        this.options = options;\r\n        this.options.icon = options.icon !== undefined ? options.icon : false;\r\n        this.options.label = options.label !== undefined ? options.label : true;\r\n        this.cssClass = '';\r\n        // Set mnemonic\r\n        if (this.options.label && options.enableMnemonics) {\r\n            let label = this.getAction().label;\r\n            if (label) {\r\n                let matches = MENU_MNEMONIC_REGEX.exec(label);\r\n                if (matches) {\r\n                    this.mnemonic = (!!matches[1] ? matches[1] : matches[3]).toLocaleLowerCase();\r\n                }\r\n            }\r\n        }\r\n        // Add mouse up listener later to avoid accidental clicks\r\n        this.runOnceToEnableMouseUp = new RunOnceScheduler(() => {\r\n            if (!this.element) {\r\n                return;\r\n            }\r\n            this._register(addDisposableListener(this.element, EventType.MOUSE_UP, e => {\r\n                // removed default prevention as it conflicts\r\n                // with BaseActionViewItem #101537\r\n                // add back if issues arise and link new issue\r\n                EventHelper.stop(e, true);\r\n                // See https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Interact_with_the_clipboard\r\n                // > Writing to the clipboard\r\n                // > You can use the \"cut\" and \"copy\" commands without any special\r\n                // permission if you are using them in a short-lived event handler\r\n                // for a user action (for example, a click handler).\r\n                // => to get the Copy and Paste context menu actions working on Firefox,\r\n                // there should be no timeout here\r\n                if (isFirefox) {\r\n                    const mouseEvent = new StandardMouseEvent(e);\r\n                    // Allowing right click to trigger the event causes the issue described below,\r\n                    // but since the solution below does not work in FF, we must disable right click\r\n                    if (mouseEvent.rightButton) {\r\n                        return;\r\n                    }\r\n                    this.onClick(e);\r\n                }\r\n                // In all other cases, set timout to allow context menu cancellation to trigger\r\n                // otherwise the action will destroy the menu and a second context menu\r\n                // will still trigger for right click.\r\n                else {\r\n                    setTimeout(() => {\r\n                        this.onClick(e);\r\n                    }, 0);\r\n                }\r\n            }));\r\n            this._register(addDisposableListener(this.element, EventType.CONTEXT_MENU, e => {\r\n                EventHelper.stop(e, true);\r\n            }));\r\n        }, 100);\r\n        this._register(this.runOnceToEnableMouseUp);\r\n    }\r\n    render(container) {\r\n        super.render(container);\r\n        if (!this.element) {\r\n            return;\r\n        }\r\n        this.container = container;\r\n        this.item = append(this.element, $('a.action-menu-item'));\r\n        if (this._action.id === Separator.ID) {\r\n            // A separator is a presentation item\r\n            this.item.setAttribute('role', 'presentation');\r\n        }\r\n        else {\r\n            this.item.setAttribute('role', 'menuitem');\r\n            if (this.mnemonic) {\r\n                this.item.setAttribute('aria-keyshortcuts', `${this.mnemonic}`);\r\n            }\r\n        }\r\n        this.check = append(this.item, $('span.menu-item-check' + menuSelectionIcon.cssSelector));\r\n        this.check.setAttribute('role', 'none');\r\n        this.label = append(this.item, $('span.action-label'));\r\n        if (this.options.label && this.options.keybinding) {\r\n            append(this.item, $('span.keybinding')).textContent = this.options.keybinding;\r\n        }\r\n        // Adds mouse up listener to actually run the action\r\n        this.runOnceToEnableMouseUp.schedule();\r\n        this.updateClass();\r\n        this.updateLabel();\r\n        this.updateTooltip();\r\n        this.updateEnabled();\r\n        this.updateChecked();\r\n    }\r\n    blur() {\r\n        super.blur();\r\n        this.applyStyle();\r\n    }\r\n    focus() {\r\n        super.focus();\r\n        if (this.item) {\r\n            this.item.focus();\r\n        }\r\n        this.applyStyle();\r\n    }\r\n    updatePositionInSet(pos, setSize) {\r\n        if (this.item) {\r\n            this.item.setAttribute('aria-posinset', `${pos}`);\r\n            this.item.setAttribute('aria-setsize', `${setSize}`);\r\n        }\r\n    }\r\n    updateLabel() {\r\n        if (!this.label) {\r\n            return;\r\n        }\r\n        if (this.options.label) {\r\n            clearNode(this.label);\r\n            let label = stripIcons(this.getAction().label);\r\n            if (label) {\r\n                const cleanLabel = cleanMnemonic(label);\r\n                if (!this.options.enableMnemonics) {\r\n                    label = cleanLabel;\r\n                }\r\n                this.label.setAttribute('aria-label', cleanLabel.replace(/&&/g, '&'));\r\n                const matches = MENU_MNEMONIC_REGEX.exec(label);\r\n                if (matches) {\r\n                    label = strings.escape(label);\r\n                    // This is global, reset it\r\n                    MENU_ESCAPED_MNEMONIC_REGEX.lastIndex = 0;\r\n                    let escMatch = MENU_ESCAPED_MNEMONIC_REGEX.exec(label);\r\n                    // We can't use negative lookbehind so if we match our negative and skip\r\n                    while (escMatch && escMatch[1]) {\r\n                        escMatch = MENU_ESCAPED_MNEMONIC_REGEX.exec(label);\r\n                    }\r\n                    const replaceDoubleEscapes = (str) => str.replace(/&amp;&amp;/g, '&amp;');\r\n                    if (escMatch) {\r\n                        this.label.append(strings.ltrim(replaceDoubleEscapes(label.substr(0, escMatch.index)), ' '), $('u', { 'aria-hidden': 'true' }, escMatch[3]), strings.rtrim(replaceDoubleEscapes(label.substr(escMatch.index + escMatch[0].length)), ' '));\r\n                    }\r\n                    else {\r\n                        this.label.innerText = replaceDoubleEscapes(label).trim();\r\n                    }\r\n                    if (this.item) {\r\n                        this.item.setAttribute('aria-keyshortcuts', (!!matches[1] ? matches[1] : matches[3]).toLocaleLowerCase());\r\n                    }\r\n                }\r\n                else {\r\n                    this.label.innerText = label.replace(/&&/g, '&').trim();\r\n                }\r\n            }\r\n        }\r\n    }\r\n    updateTooltip() {\r\n        let title = null;\r\n        if (this.getAction().tooltip) {\r\n            title = this.getAction().tooltip;\r\n        }\r\n        else if (!this.options.label && this.getAction().label && this.options.icon) {\r\n            title = this.getAction().label;\r\n            if (this.options.keybinding) {\r\n                title = nls.localize({ key: 'titleLabel', comment: ['action title', 'action keybinding'] }, \"{0} ({1})\", title, this.options.keybinding);\r\n            }\r\n        }\r\n        if (title && this.item) {\r\n            this.item.title = title;\r\n        }\r\n    }\r\n    updateClass() {\r\n        if (this.cssClass && this.item) {\r\n            this.item.classList.remove(...this.cssClass.split(' '));\r\n        }\r\n        if (this.options.icon && this.label) {\r\n            this.cssClass = this.getAction().class || '';\r\n            this.label.classList.add('icon');\r\n            if (this.cssClass) {\r\n                this.label.classList.add(...this.cssClass.split(' '));\r\n            }\r\n            this.updateEnabled();\r\n        }\r\n        else if (this.label) {\r\n            this.label.classList.remove('icon');\r\n        }\r\n    }\r\n    updateEnabled() {\r\n        if (this.getAction().enabled) {\r\n            if (this.element) {\r\n                this.element.classList.remove('disabled');\r\n            }\r\n            if (this.item) {\r\n                this.item.classList.remove('disabled');\r\n                this.item.tabIndex = 0;\r\n            }\r\n        }\r\n        else {\r\n            if (this.element) {\r\n                this.element.classList.add('disabled');\r\n            }\r\n            if (this.item) {\r\n                this.item.classList.add('disabled');\r\n                removeTabIndexAndUpdateFocus(this.item);\r\n            }\r\n        }\r\n    }\r\n    updateChecked() {\r\n        if (!this.item) {\r\n            return;\r\n        }\r\n        if (this.getAction().checked) {\r\n            this.item.classList.add('checked');\r\n            this.item.setAttribute('role', 'menuitemcheckbox');\r\n            this.item.setAttribute('aria-checked', 'true');\r\n        }\r\n        else {\r\n            this.item.classList.remove('checked');\r\n            this.item.setAttribute('role', 'menuitem');\r\n            this.item.setAttribute('aria-checked', 'false');\r\n        }\r\n    }\r\n    getMnemonic() {\r\n        return this.mnemonic;\r\n    }\r\n    applyStyle() {\r\n        if (!this.menuStyle) {\r\n            return;\r\n        }\r\n        const isSelected = this.element && this.element.classList.contains('focused');\r\n        const fgColor = isSelected && this.menuStyle.selectionForegroundColor ? this.menuStyle.selectionForegroundColor : this.menuStyle.foregroundColor;\r\n        const bgColor = isSelected && this.menuStyle.selectionBackgroundColor ? this.menuStyle.selectionBackgroundColor : undefined;\r\n        const border = isSelected && this.menuStyle.selectionBorderColor ? `thin solid ${this.menuStyle.selectionBorderColor}` : '';\r\n        if (this.item) {\r\n            this.item.style.color = fgColor ? fgColor.toString() : '';\r\n            this.item.style.backgroundColor = bgColor ? bgColor.toString() : '';\r\n        }\r\n        if (this.check) {\r\n            this.check.style.color = fgColor ? fgColor.toString() : '';\r\n        }\r\n        if (this.container) {\r\n            this.container.style.border = border;\r\n        }\r\n    }\r\n    style(style) {\r\n        this.menuStyle = style;\r\n        this.applyStyle();\r\n    }\r\n}\r\nclass SubmenuMenuActionViewItem extends BaseMenuActionViewItem {\r\n    constructor(action, submenuActions, parentData, submenuOptions) {\r\n        super(action, action, submenuOptions);\r\n        this.submenuActions = submenuActions;\r\n        this.parentData = parentData;\r\n        this.submenuOptions = submenuOptions;\r\n        this.mysubmenu = null;\r\n        this.submenuDisposables = this._register(new DisposableStore());\r\n        this.mouseOver = false;\r\n        this.expandDirection = submenuOptions && submenuOptions.expandDirection !== undefined ? submenuOptions.expandDirection : Direction.Right;\r\n        this.showScheduler = new RunOnceScheduler(() => {\r\n            if (this.mouseOver) {\r\n                this.cleanupExistingSubmenu(false);\r\n                this.createSubmenu(false);\r\n            }\r\n        }, 250);\r\n        this.hideScheduler = new RunOnceScheduler(() => {\r\n            if (this.element && (!isAncestor(getActiveElement(), this.element) && this.parentData.submenu === this.mysubmenu)) {\r\n                this.parentData.parent.focus(false);\r\n                this.cleanupExistingSubmenu(true);\r\n            }\r\n        }, 750);\r\n    }\r\n    render(container) {\r\n        super.render(container);\r\n        if (!this.element) {\r\n            return;\r\n        }\r\n        if (this.item) {\r\n            this.item.classList.add('monaco-submenu-item');\r\n            this.item.tabIndex = 0;\r\n            this.item.setAttribute('aria-haspopup', 'true');\r\n            this.updateAriaExpanded('false');\r\n            this.submenuIndicator = append(this.item, $('span.submenu-indicator' + menuSubmenuIcon.cssSelector));\r\n            this.submenuIndicator.setAttribute('aria-hidden', 'true');\r\n        }\r\n        this._register(addDisposableListener(this.element, EventType.KEY_UP, e => {\r\n            let event = new StandardKeyboardEvent(e);\r\n            if (event.equals(17 /* RightArrow */) || event.equals(3 /* Enter */)) {\r\n                EventHelper.stop(e, true);\r\n                this.createSubmenu(true);\r\n            }\r\n        }));\r\n        this._register(addDisposableListener(this.element, EventType.KEY_DOWN, e => {\r\n            let event = new StandardKeyboardEvent(e);\r\n            if (getActiveElement() === this.item) {\r\n                if (event.equals(17 /* RightArrow */) || event.equals(3 /* Enter */)) {\r\n                    EventHelper.stop(e, true);\r\n                }\r\n            }\r\n        }));\r\n        this._register(addDisposableListener(this.element, EventType.MOUSE_OVER, e => {\r\n            if (!this.mouseOver) {\r\n                this.mouseOver = true;\r\n                this.showScheduler.schedule();\r\n            }\r\n        }));\r\n        this._register(addDisposableListener(this.element, EventType.MOUSE_LEAVE, e => {\r\n            this.mouseOver = false;\r\n        }));\r\n        this._register(addDisposableListener(this.element, EventType.FOCUS_OUT, e => {\r\n            if (this.element && !isAncestor(getActiveElement(), this.element)) {\r\n                this.hideScheduler.schedule();\r\n            }\r\n        }));\r\n        this._register(this.parentData.parent.onScroll(() => {\r\n            this.parentData.parent.focus(false);\r\n            this.cleanupExistingSubmenu(false);\r\n        }));\r\n    }\r\n    updateEnabled() {\r\n        // override on submenu entry\r\n        // native menus do not observe enablement on sumbenus\r\n        // we mimic that behavior\r\n    }\r\n    onClick(e) {\r\n        // stop clicking from trying to run an action\r\n        EventHelper.stop(e, true);\r\n        this.cleanupExistingSubmenu(false);\r\n        this.createSubmenu(true);\r\n    }\r\n    cleanupExistingSubmenu(force) {\r\n        if (this.parentData.submenu && (force || (this.parentData.submenu !== this.mysubmenu))) {\r\n            // disposal may throw if the submenu has already been removed\r\n            try {\r\n                this.parentData.submenu.dispose();\r\n            }\r\n            catch (_a) { }\r\n            this.parentData.submenu = undefined;\r\n            this.updateAriaExpanded('false');\r\n            if (this.submenuContainer) {\r\n                this.submenuDisposables.clear();\r\n                this.submenuContainer = undefined;\r\n            }\r\n        }\r\n    }\r\n    calculateSubmenuMenuLayout(windowDimensions, submenu, entry, expandDirection) {\r\n        const ret = { top: 0, left: 0 };\r\n        // Start with horizontal\r\n        ret.left = layout(windowDimensions.width, submenu.width, { position: expandDirection === Direction.Right ? 0 /* Before */ : 1 /* After */, offset: entry.left, size: entry.width });\r\n        // We don't have enough room to layout the menu fully, so we are overlapping the menu\r\n        if (ret.left >= entry.left && ret.left < entry.left + entry.width) {\r\n            if (entry.left + 10 + submenu.width <= windowDimensions.width) {\r\n                ret.left = entry.left + 10;\r\n            }\r\n            entry.top += 10;\r\n            entry.height = 0;\r\n        }\r\n        // Now that we have a horizontal position, try layout vertically\r\n        ret.top = layout(windowDimensions.height, submenu.height, { position: 0 /* Before */, offset: entry.top, size: 0 });\r\n        // We didn't have enough room below, but we did above, so we shift down to align the menu\r\n        if (ret.top + submenu.height === entry.top && ret.top + entry.height + submenu.height <= windowDimensions.height) {\r\n            ret.top += entry.height;\r\n        }\r\n        return ret;\r\n    }\r\n    createSubmenu(selectFirstItem = true) {\r\n        if (!this.element) {\r\n            return;\r\n        }\r\n        if (!this.parentData.submenu) {\r\n            this.updateAriaExpanded('true');\r\n            this.submenuContainer = append(this.element, $('div.monaco-submenu'));\r\n            this.submenuContainer.classList.add('menubar-menu-items-holder', 'context-view');\r\n            // Set the top value of the menu container before construction\r\n            // This allows the menu constructor to calculate the proper max height\r\n            const computedStyles = getComputedStyle(this.parentData.parent.domNode);\r\n            const paddingTop = parseFloat(computedStyles.paddingTop || '0') || 0;\r\n            // this.submenuContainer.style.top = `${this.element.offsetTop - this.parentData.parent.scrollOffset - paddingTop}px`;\r\n            this.submenuContainer.style.zIndex = '1';\r\n            this.submenuContainer.style.position = 'fixed';\r\n            this.submenuContainer.style.top = '0';\r\n            this.submenuContainer.style.left = '0';\r\n            this.parentData.submenu = new Menu(this.submenuContainer, this.submenuActions.length ? this.submenuActions : [new EmptySubmenuAction()], this.submenuOptions);\r\n            if (this.menuStyle) {\r\n                this.parentData.submenu.style(this.menuStyle);\r\n            }\r\n            // layout submenu\r\n            const entryBox = this.element.getBoundingClientRect();\r\n            const entryBoxUpdated = {\r\n                top: entryBox.top - paddingTop,\r\n                left: entryBox.left,\r\n                height: entryBox.height + 2 * paddingTop,\r\n                width: entryBox.width\r\n            };\r\n            const viewBox = this.submenuContainer.getBoundingClientRect();\r\n            const { top, left } = this.calculateSubmenuMenuLayout(new Dimension(window.innerWidth, window.innerHeight), Dimension.lift(viewBox), entryBoxUpdated, this.expandDirection);\r\n            this.submenuContainer.style.left = `${left}px`;\r\n            this.submenuContainer.style.top = `${top}px`;\r\n            this.submenuDisposables.add(addDisposableListener(this.submenuContainer, EventType.KEY_UP, e => {\r\n                let event = new StandardKeyboardEvent(e);\r\n                if (event.equals(15 /* LeftArrow */)) {\r\n                    EventHelper.stop(e, true);\r\n                    this.parentData.parent.focus();\r\n                    this.cleanupExistingSubmenu(true);\r\n                }\r\n            }));\r\n            this.submenuDisposables.add(addDisposableListener(this.submenuContainer, EventType.KEY_DOWN, e => {\r\n                let event = new StandardKeyboardEvent(e);\r\n                if (event.equals(15 /* LeftArrow */)) {\r\n                    EventHelper.stop(e, true);\r\n                }\r\n            }));\r\n            this.submenuDisposables.add(this.parentData.submenu.onDidCancel(() => {\r\n                this.parentData.parent.focus();\r\n                this.cleanupExistingSubmenu(true);\r\n            }));\r\n            this.parentData.submenu.focus(selectFirstItem);\r\n            this.mysubmenu = this.parentData.submenu;\r\n        }\r\n        else {\r\n            this.parentData.submenu.focus(false);\r\n        }\r\n    }\r\n    updateAriaExpanded(value) {\r\n        var _a;\r\n        if (this.item) {\r\n            (_a = this.item) === null || _a === void 0 ? void 0 : _a.setAttribute('aria-expanded', value);\r\n        }\r\n    }\r\n    applyStyle() {\r\n        super.applyStyle();\r\n        if (!this.menuStyle) {\r\n            return;\r\n        }\r\n        const isSelected = this.element && this.element.classList.contains('focused');\r\n        const fgColor = isSelected && this.menuStyle.selectionForegroundColor ? this.menuStyle.selectionForegroundColor : this.menuStyle.foregroundColor;\r\n        if (this.submenuIndicator) {\r\n            this.submenuIndicator.style.color = fgColor ? `${fgColor}` : '';\r\n        }\r\n        if (this.parentData.submenu) {\r\n            this.parentData.submenu.style(this.menuStyle);\r\n        }\r\n    }\r\n    dispose() {\r\n        super.dispose();\r\n        this.hideScheduler.dispose();\r\n        if (this.mysubmenu) {\r\n            this.mysubmenu.dispose();\r\n            this.mysubmenu = null;\r\n        }\r\n        if (this.submenuContainer) {\r\n            this.submenuContainer = undefined;\r\n        }\r\n    }\r\n}\r\nclass MenuSeparatorActionViewItem extends ActionViewItem {\r\n    style(style) {\r\n        if (this.label) {\r\n            this.label.style.borderBottomColor = style.separatorColor ? `${style.separatorColor}` : '';\r\n        }\r\n    }\r\n}\r\nexport function cleanMnemonic(label) {\r\n    const regex = MENU_MNEMONIC_REGEX;\r\n    const matches = regex.exec(label);\r\n    if (!matches) {\r\n        return label;\r\n    }\r\n    const mnemonicInText = !matches[1];\r\n    return label.replace(regex, mnemonicInText ? '$2$3' : '').trim();\r\n}\r\nlet MENU_WIDGET_CSS = `\n.monaco-menu {\n\tfont-size: 13px;\n\n}\n\n${formatRule(menuSelectionIcon)}\n${formatRule(menuSubmenuIcon)}\n\n.monaco-menu .monaco-action-bar {\n\ttext-align: right;\n\toverflow: hidden;\n\twhite-space: nowrap;\n}\n\n.monaco-menu .monaco-action-bar .actions-container {\n\tdisplay: flex;\n\tmargin: 0 auto;\n\tpadding: 0;\n\twidth: 100%;\n\tjustify-content: flex-end;\n}\n\n.monaco-menu .monaco-action-bar.vertical .actions-container {\n\tdisplay: inline-block;\n}\n\n.monaco-menu .monaco-action-bar.reverse .actions-container {\n\tflex-direction: row-reverse;\n}\n\n.monaco-menu .monaco-action-bar .action-item {\n\tcursor: pointer;\n\tdisplay: inline-block;\n\ttransition: transform 50ms ease;\n\tposition: relative;  /* DO NOT REMOVE - this is the key to preventing the ghosting icon bug in Chrome 42 */\n}\n\n.monaco-menu .monaco-action-bar .action-item.disabled {\n\tcursor: default;\n}\n\n.monaco-menu .monaco-action-bar.animated .action-item.active {\n\ttransform: scale(1.272019649, 1.272019649); /* 1.272019649 =  */\n}\n\n.monaco-menu .monaco-action-bar .action-item .icon,\n.monaco-menu .monaco-action-bar .action-item .codicon {\n\tdisplay: inline-block;\n}\n\n.monaco-menu .monaco-action-bar .action-item .codicon {\n\tdisplay: flex;\n\talign-items: center;\n}\n\n.monaco-menu .monaco-action-bar .action-label {\n\tfont-size: 11px;\n\tmargin-right: 4px;\n}\n\n.monaco-menu .monaco-action-bar .action-item.disabled .action-label,\n.monaco-menu .monaco-action-bar .action-item.disabled .action-label:hover {\n\topacity: 0.4;\n}\n\n/* Vertical actions */\n\n.monaco-menu .monaco-action-bar.vertical {\n\ttext-align: left;\n}\n\n.monaco-menu .monaco-action-bar.vertical .action-item {\n\tdisplay: block;\n}\n\n.monaco-menu .monaco-action-bar.vertical .action-label.separator {\n\tdisplay: block;\n\tborder-bottom: 1px solid #bbb;\n\tpadding-top: 1px;\n\tmargin-left: .8em;\n\tmargin-right: .8em;\n}\n\n.monaco-menu .secondary-actions .monaco-action-bar .action-label {\n\tmargin-left: 6px;\n}\n\n/* Action Items */\n.monaco-menu .monaco-action-bar .action-item.select-container {\n\toverflow: hidden; /* somehow the dropdown overflows its container, we prevent it here to not push */\n\tflex: 1;\n\tmax-width: 170px;\n\tmin-width: 60px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tmargin-right: 10px;\n}\n\n.monaco-menu .monaco-action-bar.vertical {\n\tmargin-left: 0;\n\toverflow: visible;\n}\n\n.monaco-menu .monaco-action-bar.vertical .actions-container {\n\tdisplay: block;\n}\n\n.monaco-menu .monaco-action-bar.vertical .action-item {\n\tpadding: 0;\n\ttransform: none;\n\tdisplay: flex;\n}\n\n.monaco-menu .monaco-action-bar.vertical .action-item.active {\n\ttransform: none;\n}\n\n.monaco-menu .monaco-action-bar.vertical .action-menu-item {\n\tflex: 1 1 auto;\n\tdisplay: flex;\n\theight: 2em;\n\talign-items: center;\n\tposition: relative;\n}\n\n.monaco-menu .monaco-action-bar.vertical .action-label {\n\tflex: 1 1 auto;\n\ttext-decoration: none;\n\tpadding: 0 1em;\n\tbackground: none;\n\tfont-size: 12px;\n\tline-height: 1;\n}\n\n.monaco-menu .monaco-action-bar.vertical .keybinding,\n.monaco-menu .monaco-action-bar.vertical .submenu-indicator {\n\tdisplay: inline-block;\n\tflex: 2 1 auto;\n\tpadding: 0 1em;\n\ttext-align: right;\n\tfont-size: 12px;\n\tline-height: 1;\n}\n\n.monaco-menu .monaco-action-bar.vertical .submenu-indicator {\n\theight: 100%;\n}\n\n.monaco-menu .monaco-action-bar.vertical .submenu-indicator.codicon {\n\tfont-size: 16px !important;\n\tdisplay: flex;\n\talign-items: center;\n}\n\n.monaco-menu .monaco-action-bar.vertical .submenu-indicator.codicon::before {\n\tmargin-left: auto;\n\tmargin-right: -20px;\n}\n\n.monaco-menu .monaco-action-bar.vertical .action-item.disabled .keybinding,\n.monaco-menu .monaco-action-bar.vertical .action-item.disabled .submenu-indicator {\n\topacity: 0.4;\n}\n\n.monaco-menu .monaco-action-bar.vertical .action-label:not(.separator) {\n\tdisplay: inline-block;\n\tbox-sizing: border-box;\n\tmargin: 0;\n}\n\n.monaco-menu .monaco-action-bar.vertical .action-item {\n\tposition: static;\n\toverflow: visible;\n}\n\n.monaco-menu .monaco-action-bar.vertical .action-item .monaco-submenu {\n\tposition: absolute;\n}\n\n.monaco-menu .monaco-action-bar.vertical .action-label.separator {\n\tpadding: 0.5em 0 0 0;\n\tmargin-bottom: 0.5em;\n\twidth: 100%;\n\theight: 0px !important;\n\tmargin-left: .8em !important;\n\tmargin-right: .8em !important;\n}\n\n.monaco-menu .monaco-action-bar.vertical .action-label.separator.text {\n\tpadding: 0.7em 1em 0.1em 1em;\n\tfont-weight: bold;\n\topacity: 1;\n}\n\n.monaco-menu .monaco-action-bar.vertical .action-label:hover {\n\tcolor: inherit;\n}\n\n.monaco-menu .monaco-action-bar.vertical .menu-item-check {\n\tposition: absolute;\n\tvisibility: hidden;\n\twidth: 1em;\n\theight: 100%;\n}\n\n.monaco-menu .monaco-action-bar.vertical .action-menu-item.checked .menu-item-check {\n\tvisibility: visible;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n\n/* Context Menu */\n\n.context-view.monaco-menu-container {\n\toutline: 0;\n\tborder: none;\n\tanimation: fadeIn 0.083s linear;\n\t-webkit-app-region: no-drag;\n}\n\n.context-view.monaco-menu-container :focus,\n.context-view.monaco-menu-container .monaco-action-bar.vertical:focus,\n.context-view.monaco-menu-container .monaco-action-bar.vertical :focus {\n\toutline: 0;\n}\n\n.monaco-menu .monaco-action-bar.vertical .action-item {\n\tborder: thin solid transparent; /* prevents jumping behaviour on hover or focus */\n}\n\n\n/* High Contrast Theming */\n:host-context(.hc-black) .context-view.monaco-menu-container {\n\tbox-shadow: none;\n}\n\n:host-context(.hc-black) .monaco-menu .monaco-action-bar.vertical .action-item.focused {\n\tbackground: none;\n}\n\n/* Vertical Action Bar Styles */\n\n.monaco-menu .monaco-action-bar.vertical {\n\tpadding: .5em 0;\n}\n\n.monaco-menu .monaco-action-bar.vertical .action-menu-item {\n\theight: 1.8em;\n}\n\n.monaco-menu .monaco-action-bar.vertical .action-label:not(.separator),\n.monaco-menu .monaco-action-bar.vertical .keybinding {\n\tfont-size: inherit;\n\tpadding: 0 2em;\n}\n\n.monaco-menu .monaco-action-bar.vertical .menu-item-check {\n\tfont-size: inherit;\n\twidth: 2em;\n}\n\n.monaco-menu .monaco-action-bar.vertical .action-label.separator {\n\tfont-size: inherit;\n\tpadding: 0.2em 0 0 0;\n\tmargin-bottom: 0.2em;\n}\n\n:host-context(.linux) .monaco-menu .monaco-action-bar.vertical .action-label.separator {\n\tmargin-left: 0;\n\tmargin-right: 0;\n}\n\n.monaco-menu .monaco-action-bar.vertical .submenu-indicator {\n\tfont-size: 60%;\n\tpadding: 0 1.8em;\n}\n\n:host-context(.linux) .monaco-menu .monaco-action-bar.vertical .submenu-indicator {\n\theight: 100%;\n\tmask-size: 10px 10px;\n\t-webkit-mask-size: 10px 10px;\n}\n\n.monaco-menu .action-item {\n\tcursor: default;\n}\n\n/* Arrows */\n.monaco-scrollable-element > .scrollbar > .scra {\n\tcursor: pointer;\n\tfont-size: 11px !important;\n}\n\n.monaco-scrollable-element > .visible {\n\topacity: 1;\n\n\t/* Background rule added for IE9 - to allow clicks on dom node */\n\tbackground:rgba(0,0,0,0);\n\n\ttransition: opacity 100ms linear;\n}\n.monaco-scrollable-element > .invisible {\n\topacity: 0;\n\tpointer-events: none;\n}\n.monaco-scrollable-element > .invisible.fade {\n\ttransition: opacity 800ms linear;\n}\n\n/* Scrollable Content Inset Shadow */\n.monaco-scrollable-element > .shadow {\n\tposition: absolute;\n\tdisplay: none;\n}\n.monaco-scrollable-element > .shadow.top {\n\tdisplay: block;\n\ttop: 0;\n\tleft: 3px;\n\theight: 3px;\n\twidth: 100%;\n\tbox-shadow: #DDD 0 6px 6px -6px inset;\n}\n.monaco-scrollable-element > .shadow.left {\n\tdisplay: block;\n\ttop: 3px;\n\tleft: 0;\n\theight: 100%;\n\twidth: 3px;\n\tbox-shadow: #DDD 6px 0 6px -6px inset;\n}\n.monaco-scrollable-element > .shadow.top-left-corner {\n\tdisplay: block;\n\ttop: 0;\n\tleft: 0;\n\theight: 3px;\n\twidth: 3px;\n}\n.monaco-scrollable-element > .shadow.top.left {\n\tbox-shadow: #DDD 6px 6px 6px -6px inset;\n}\n\n/* ---------- Default Style ---------- */\n\n:host-context(.vs) .monaco-scrollable-element > .scrollbar > .slider {\n\tbackground: rgba(100, 100, 100, .4);\n}\n:host-context(.vs-dark) .monaco-scrollable-element > .scrollbar > .slider {\n\tbackground: rgba(121, 121, 121, .4);\n}\n:host-context(.hc-black) .monaco-scrollable-element > .scrollbar > .slider {\n\tbackground: rgba(111, 195, 223, .6);\n}\n\n.monaco-scrollable-element > .scrollbar > .slider:hover {\n\tbackground: rgba(100, 100, 100, .7);\n}\n:host-context(.hc-black) .monaco-scrollable-element > .scrollbar > .slider:hover {\n\tbackground: rgba(111, 195, 223, .8);\n}\n\n.monaco-scrollable-element > .scrollbar > .slider.active {\n\tbackground: rgba(0, 0, 0, .6);\n}\n:host-context(.vs-dark) .monaco-scrollable-element > .scrollbar > .slider.active {\n\tbackground: rgba(191, 191, 191, .4);\n}\n:host-context(.hc-black) .monaco-scrollable-element > .scrollbar > .slider.active {\n\tbackground: rgba(111, 195, 223, 1);\n}\n\n:host-context(.vs-dark) .monaco-scrollable-element .shadow.top {\n\tbox-shadow: none;\n}\n\n:host-context(.vs-dark) .monaco-scrollable-element .shadow.left {\n\tbox-shadow: #000 6px 0 6px -6px inset;\n}\n\n:host-context(.vs-dark) .monaco-scrollable-element .shadow.top.left {\n\tbox-shadow: #000 6px 6px 6px -6px inset;\n}\n\n:host-context(.hc-black) .monaco-scrollable-element .shadow.top {\n\tbox-shadow: none;\n}\n\n:host-context(.hc-black) .monaco-scrollable-element .shadow.left {\n\tbox-shadow: none;\n}\n\n:host-context(.hc-black) .monaco-scrollable-element .shadow.top.left {\n\tbox-shadow: none;\n}\n`;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}