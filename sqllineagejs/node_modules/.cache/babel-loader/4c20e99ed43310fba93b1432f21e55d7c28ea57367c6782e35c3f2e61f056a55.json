{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nimport './contextMenuHandler.css';\nimport { ActionRunner } from '../../../base/common/actions.js';\nimport { combinedDisposable, DisposableStore } from '../../../base/common/lifecycle.js';\nimport { Menu } from '../../../base/browser/ui/menu/menu.js';\nimport { EventType, $, isHTMLElement } from '../../../base/browser/dom.js';\nimport { attachMenuStyler } from '../../theme/common/styler.js';\nimport { domEvent } from '../../../base/browser/event.js';\nimport { StandardMouseEvent } from '../../../base/browser/mouseEvent.js';\nexport class ContextMenuHandler {\n  constructor(contextViewService, telemetryService, notificationService, keybindingService, themeService) {\n    this.contextViewService = contextViewService;\n    this.telemetryService = telemetryService;\n    this.notificationService = notificationService;\n    this.keybindingService = keybindingService;\n    this.themeService = themeService;\n    this.focusToReturn = null;\n    this.block = null;\n    this.options = {\n      blockMouse: true\n    };\n  }\n  configure(options) {\n    this.options = options;\n  }\n  showContextMenu(delegate) {\n    const actions = delegate.getActions();\n    if (!actions.length) {\n      return; // Don't render an empty context menu\n    }\n\n    this.focusToReturn = document.activeElement;\n    let menu;\n    let shadowRootElement = isHTMLElement(delegate.domForShadowRoot) ? delegate.domForShadowRoot : undefined;\n    this.contextViewService.showContextView({\n      getAnchor: () => delegate.getAnchor(),\n      canRelayout: false,\n      anchorAlignment: delegate.anchorAlignment,\n      anchorAxisAlignment: delegate.anchorAxisAlignment,\n      render: container => {\n        let className = delegate.getMenuClassName ? delegate.getMenuClassName() : '';\n        if (className) {\n          container.className += ' ' + className;\n        }\n        // Render invisible div to block mouse interaction in the rest of the UI\n        if (this.options.blockMouse) {\n          this.block = container.appendChild($('.context-view-block'));\n          this.block.style.position = 'fixed';\n          this.block.style.cursor = 'initial';\n          this.block.style.left = '0';\n          this.block.style.top = '0';\n          this.block.style.width = '100%';\n          this.block.style.height = '100%';\n          this.block.style.zIndex = '-1';\n          domEvent(this.block, EventType.MOUSE_DOWN)(e => e.stopPropagation());\n        }\n        const menuDisposables = new DisposableStore();\n        const actionRunner = delegate.actionRunner || new ActionRunner();\n        actionRunner.onBeforeRun(this.onActionRun, this, menuDisposables);\n        actionRunner.onDidRun(this.onDidActionRun, this, menuDisposables);\n        menu = new Menu(container, actions, {\n          actionViewItemProvider: delegate.getActionViewItem,\n          context: delegate.getActionsContext ? delegate.getActionsContext() : null,\n          actionRunner,\n          getKeyBinding: delegate.getKeyBinding ? delegate.getKeyBinding : action => this.keybindingService.lookupKeybinding(action.id)\n        });\n        menuDisposables.add(attachMenuStyler(menu, this.themeService));\n        menu.onDidCancel(() => this.contextViewService.hideContextView(true), null, menuDisposables);\n        menu.onDidBlur(() => this.contextViewService.hideContextView(true), null, menuDisposables);\n        domEvent(window, EventType.BLUR)(() => {\n          this.contextViewService.hideContextView(true);\n        }, null, menuDisposables);\n        domEvent(window, EventType.MOUSE_DOWN)(e => {\n          if (e.defaultPrevented) {\n            return;\n          }\n          let event = new StandardMouseEvent(e);\n          let element = event.target;\n          // Don't do anything as we are likely creating a context menu\n          if (event.rightButton) {\n            return;\n          }\n          while (element) {\n            if (element === container) {\n              return;\n            }\n            element = element.parentElement;\n          }\n          this.contextViewService.hideContextView(true);\n        }, null, menuDisposables);\n        return combinedDisposable(menuDisposables, menu);\n      },\n      focus: () => {\n        if (menu) {\n          menu.focus(!!delegate.autoSelectFirstItem);\n        }\n      },\n      onHide: didCancel => {\n        if (delegate.onHide) {\n          delegate.onHide(!!didCancel);\n        }\n        if (this.block) {\n          this.block.remove();\n          this.block = null;\n        }\n        if (this.focusToReturn) {\n          this.focusToReturn.focus();\n        }\n      }\n    }, shadowRootElement, !!shadowRootElement);\n  }\n  onActionRun(e) {\n    if (this.telemetryService) {\n      this.telemetryService.publicLog2('workbenchActionExecuted', {\n        id: e.action.id,\n        from: 'contextMenu'\n      });\n    }\n    this.contextViewService.hideContextView(false);\n    // Restore focus here\n    if (this.focusToReturn) {\n      this.focusToReturn.focus();\n    }\n  }\n  onDidActionRun(e) {\n    if (e.error) {\n      this.notificationService.error(e.error);\n    }\n  }\n}","map":{"version":3,"names":["ActionRunner","combinedDisposable","DisposableStore","Menu","EventType","$","isHTMLElement","attachMenuStyler","domEvent","StandardMouseEvent","ContextMenuHandler","constructor","contextViewService","telemetryService","notificationService","keybindingService","themeService","focusToReturn","block","options","blockMouse","configure","showContextMenu","delegate","actions","getActions","length","document","activeElement","menu","shadowRootElement","domForShadowRoot","undefined","showContextView","getAnchor","canRelayout","anchorAlignment","anchorAxisAlignment","render","container","className","getMenuClassName","appendChild","style","position","cursor","left","top","width","height","zIndex","MOUSE_DOWN","e","stopPropagation","menuDisposables","actionRunner","onBeforeRun","onActionRun","onDidRun","onDidActionRun","actionViewItemProvider","getActionViewItem","context","getActionsContext","getKeyBinding","action","lookupKeybinding","id","add","onDidCancel","hideContextView","onDidBlur","window","BLUR","defaultPrevented","event","element","target","rightButton","parentElement","focus","autoSelectFirstItem","onHide","didCancel","remove","publicLog2","from","error"],"sources":["C:/Users/Administrator/Desktop/sqllineage-master/sqllineagejs/node_modules/monaco-editor/esm/vs/platform/contextview/browser/contextMenuHandler.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport './contextMenuHandler.css';\r\nimport { ActionRunner } from '../../../base/common/actions.js';\r\nimport { combinedDisposable, DisposableStore } from '../../../base/common/lifecycle.js';\r\nimport { Menu } from '../../../base/browser/ui/menu/menu.js';\r\nimport { EventType, $, isHTMLElement } from '../../../base/browser/dom.js';\r\nimport { attachMenuStyler } from '../../theme/common/styler.js';\r\nimport { domEvent } from '../../../base/browser/event.js';\r\nimport { StandardMouseEvent } from '../../../base/browser/mouseEvent.js';\r\nexport class ContextMenuHandler {\r\n    constructor(contextViewService, telemetryService, notificationService, keybindingService, themeService) {\r\n        this.contextViewService = contextViewService;\r\n        this.telemetryService = telemetryService;\r\n        this.notificationService = notificationService;\r\n        this.keybindingService = keybindingService;\r\n        this.themeService = themeService;\r\n        this.focusToReturn = null;\r\n        this.block = null;\r\n        this.options = { blockMouse: true };\r\n    }\r\n    configure(options) {\r\n        this.options = options;\r\n    }\r\n    showContextMenu(delegate) {\r\n        const actions = delegate.getActions();\r\n        if (!actions.length) {\r\n            return; // Don't render an empty context menu\r\n        }\r\n        this.focusToReturn = document.activeElement;\r\n        let menu;\r\n        let shadowRootElement = isHTMLElement(delegate.domForShadowRoot) ? delegate.domForShadowRoot : undefined;\r\n        this.contextViewService.showContextView({\r\n            getAnchor: () => delegate.getAnchor(),\r\n            canRelayout: false,\r\n            anchorAlignment: delegate.anchorAlignment,\r\n            anchorAxisAlignment: delegate.anchorAxisAlignment,\r\n            render: (container) => {\r\n                let className = delegate.getMenuClassName ? delegate.getMenuClassName() : '';\r\n                if (className) {\r\n                    container.className += ' ' + className;\r\n                }\r\n                // Render invisible div to block mouse interaction in the rest of the UI\r\n                if (this.options.blockMouse) {\r\n                    this.block = container.appendChild($('.context-view-block'));\r\n                    this.block.style.position = 'fixed';\r\n                    this.block.style.cursor = 'initial';\r\n                    this.block.style.left = '0';\r\n                    this.block.style.top = '0';\r\n                    this.block.style.width = '100%';\r\n                    this.block.style.height = '100%';\r\n                    this.block.style.zIndex = '-1';\r\n                    domEvent(this.block, EventType.MOUSE_DOWN)((e) => e.stopPropagation());\r\n                }\r\n                const menuDisposables = new DisposableStore();\r\n                const actionRunner = delegate.actionRunner || new ActionRunner();\r\n                actionRunner.onBeforeRun(this.onActionRun, this, menuDisposables);\r\n                actionRunner.onDidRun(this.onDidActionRun, this, menuDisposables);\r\n                menu = new Menu(container, actions, {\r\n                    actionViewItemProvider: delegate.getActionViewItem,\r\n                    context: delegate.getActionsContext ? delegate.getActionsContext() : null,\r\n                    actionRunner,\r\n                    getKeyBinding: delegate.getKeyBinding ? delegate.getKeyBinding : action => this.keybindingService.lookupKeybinding(action.id)\r\n                });\r\n                menuDisposables.add(attachMenuStyler(menu, this.themeService));\r\n                menu.onDidCancel(() => this.contextViewService.hideContextView(true), null, menuDisposables);\r\n                menu.onDidBlur(() => this.contextViewService.hideContextView(true), null, menuDisposables);\r\n                domEvent(window, EventType.BLUR)(() => { this.contextViewService.hideContextView(true); }, null, menuDisposables);\r\n                domEvent(window, EventType.MOUSE_DOWN)((e) => {\r\n                    if (e.defaultPrevented) {\r\n                        return;\r\n                    }\r\n                    let event = new StandardMouseEvent(e);\r\n                    let element = event.target;\r\n                    // Don't do anything as we are likely creating a context menu\r\n                    if (event.rightButton) {\r\n                        return;\r\n                    }\r\n                    while (element) {\r\n                        if (element === container) {\r\n                            return;\r\n                        }\r\n                        element = element.parentElement;\r\n                    }\r\n                    this.contextViewService.hideContextView(true);\r\n                }, null, menuDisposables);\r\n                return combinedDisposable(menuDisposables, menu);\r\n            },\r\n            focus: () => {\r\n                if (menu) {\r\n                    menu.focus(!!delegate.autoSelectFirstItem);\r\n                }\r\n            },\r\n            onHide: (didCancel) => {\r\n                if (delegate.onHide) {\r\n                    delegate.onHide(!!didCancel);\r\n                }\r\n                if (this.block) {\r\n                    this.block.remove();\r\n                    this.block = null;\r\n                }\r\n                if (this.focusToReturn) {\r\n                    this.focusToReturn.focus();\r\n                }\r\n            }\r\n        }, shadowRootElement, !!shadowRootElement);\r\n    }\r\n    onActionRun(e) {\r\n        if (this.telemetryService) {\r\n            this.telemetryService.publicLog2('workbenchActionExecuted', { id: e.action.id, from: 'contextMenu' });\r\n        }\r\n        this.contextViewService.hideContextView(false);\r\n        // Restore focus here\r\n        if (this.focusToReturn) {\r\n            this.focusToReturn.focus();\r\n        }\r\n    }\r\n    onDidActionRun(e) {\r\n        if (e.error) {\r\n            this.notificationService.error(e.error);\r\n        }\r\n    }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}