{"ast":null,"code":"import React,{useEffect}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{fetchContent,fetchDAG,selectEditor,setContentComposed,setDagLevel,setEditable,setFile,setDialect}from\"./editorSlice\";import MonacoEditor from\"react-monaco-editor\";import{Loading}from\"../widget/Loading\";import{LoadError}from\"../widget/LoadError\";import{useHistory,useLocation}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";const useQueryParam=()=>{return new URLSearchParams(useLocation().search);};export function Editor(props){const{height,width,dialect}=props;const dispatch=useDispatch();const editorState=useSelector(selectEditor);const queryParam=useQueryParam();const history=useHistory();useEffect(()=>{let query=queryParam.get(\"e\");if(query!==null){dispatch(setContentComposed(query));history.push(\"/\");}else{let file=queryParam.get(\"f\");if(editorState.file!==file||editorState.dialect!==dialect){dispatch(setFile(file));dispatch(setDialect(dialect));dispatch(setDagLevel(\"table\"));if(file===null){dispatch(setEditable(true));dispatch(fetchDAG({\"e\":editorState.contentComposed}));}else{dispatch(setEditable(false));dispatch(fetchContent({\"f\":file}));dispatch(fetchDAG({\"f\":file}));}}}});const handleEditorDidMount=(editor,monaco)=>{const readOnly=monaco.editor.EditorOption.readOnly;editor.onDidBlurEditorText(()=>{if(!editor.getOption(readOnly)){dispatch(setContentComposed(editor.getValue()));dispatch(fetchDAG({\"e\":editor.getValue()}));}});editor.onKeyDown(()=>{// This is a walk-around to trigger \"Cannot editor in readonly editor\". Be default this tooltip is only shown\n// when user press backspace key on readonly editor, we want it with any key\nif(editor.getOption(readOnly)){editor.trigger(monaco.KeyCode.Backspace,'deleteLeft');}});};if(editorState.editorStatus===\"loading\"){return/*#__PURE__*/_jsx(Loading,{minHeight:height});}else if(editorState.editorStatus===\"failed\"){return/*#__PURE__*/_jsx(LoadError,{minHeight:height,message:editorState.editorError});}else{const options={minimap:{enabled:false},readOnly:!editorState.editable,wordWrap:\"on\",automaticLayout:true};return/*#__PURE__*/_jsx(MonacoEditor,{width:width,height:height,language:\"sql\",value:editorState.editable?editorState.contentComposed:editorState.content,options:options,editorDidMount:handleEditorDidMount});}}","map":{"version":3,"names":["React","useEffect","useDispatch","useSelector","fetchContent","fetchDAG","selectEditor","setContentComposed","setDagLevel","setEditable","setFile","setDialect","MonacoEditor","Loading","LoadError","useHistory","useLocation","jsx","_jsx","useQueryParam","URLSearchParams","search","Editor","props","height","width","dialect","dispatch","editorState","queryParam","history","query","get","push","file","contentComposed","handleEditorDidMount","editor","monaco","readOnly","EditorOption","onDidBlurEditorText","getOption","getValue","onKeyDown","trigger","KeyCode","Backspace","editorStatus","minHeight","message","editorError","options","minimap","enabled","editable","wordWrap","automaticLayout","language","value","content","editorDidMount"],"sources":["C:/Users/Administrator/Desktop/sqllineage-master/sqllineagejs/src/features/editor/Editor.js"],"sourcesContent":["import React, {useEffect} from \"react\";\nimport {useDispatch, useSelector} from \"react-redux\";\nimport {\n  fetchContent,\n  fetchDAG,\n  selectEditor,\n  setContentComposed,\n  setDagLevel,\n  setEditable,\n  setFile,\n  setDialect\n} from \"./editorSlice\";\nimport MonacoEditor from \"react-monaco-editor\";\nimport {Loading} from \"../widget/Loading\";\nimport {LoadError} from \"../widget/LoadError\";\nimport {useHistory, useLocation} from \"react-router-dom\";\n\nconst useQueryParam = () => {\n  return new URLSearchParams(useLocation().search)\n};\n\nexport function Editor(props) {\n  const { height, width, dialect } = props;\n  const dispatch = useDispatch();\n  const editorState = useSelector(selectEditor);\n  const queryParam = useQueryParam();\n  const history = useHistory();\n\n  useEffect(() => {\n    let query = queryParam.get(\"e\");\n    if (query !== null) {\n      dispatch(setContentComposed(query));\n      history.push(\"/\");\n    } else {\n      let file = queryParam.get(\"f\");\n      if (editorState.file !== file || editorState.dialect !== dialect) {\n        dispatch(setFile(file));\n        dispatch(setDialect(dialect));\n        dispatch(setDagLevel(\"table\"));\n        if (file === null) {\n          dispatch(setEditable(true));\n          dispatch(fetchDAG({\"e\": editorState.contentComposed}))\n        } else {\n          dispatch(setEditable(false));\n          dispatch(fetchContent({\"f\": file}));\n          dispatch(fetchDAG({\"f\": file}));\n        }\n      }\n    }\n  })\n\n  const handleEditorDidMount = (editor, monaco) => {\n    const readOnly = monaco.editor.EditorOption.readOnly;\n    editor.onDidBlurEditorText(() => {\n      if (!editor.getOption(readOnly)) {\n        dispatch(setContentComposed(editor.getValue()));\n        dispatch(fetchDAG({\"e\": editor.getValue()}));\n      }\n    })\n    editor.onKeyDown(() => {\n      // This is a walk-around to trigger \"Cannot editor in readonly editor\". Be default this tooltip is only shown\n      // when user press backspace key on readonly editor, we want it with any key\n      if (editor.getOption(readOnly)) {\n        editor.trigger(monaco.KeyCode.Backspace, 'deleteLeft')\n      }\n    })\n  }\n\n  if (editorState.editorStatus === \"loading\") {\n    return <Loading minHeight={height}/>\n  } else if (editorState.editorStatus === \"failed\") {\n    return <LoadError minHeight={height} message={editorState.editorError}/>\n  } else {\n    const options = {\n      minimap: {enabled: false},\n      readOnly: !editorState.editable,\n      wordWrap: \"on\",\n      automaticLayout: true\n    }\n    return <MonacoEditor\n      width={width}\n      height={height}\n      language=\"sql\"\n      value={editorState.editable ? editorState.contentComposed : editorState.content}\n      options={options}\n      editorDidMount={handleEditorDidMount}\n    />\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}